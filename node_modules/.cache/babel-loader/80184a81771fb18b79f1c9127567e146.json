{"ast":null,"code":"import _typeof from \"/home/ea/Development/Babylon/red/node_modules/@babel/runtime/helpers/esm/typeof.js\";\nimport \"core-js/modules/es.object.define-property.js\";\nimport \"core-js/modules/es.math.fround.js\";\nimport \"core-js/modules/es.array.last-index-of.js\";\nimport \"core-js/modules/es.array.is-array.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.replace.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/web.url.js\";\nimport \"core-js/modules/web.url-search-params.js\";\nimport \"core-js/modules/es.number.to-fixed.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.array-buffer.slice.js\";\nimport \"core-js/modules/es.typed-array.uint8-array.js\";\nimport \"core-js/modules/es.typed-array.at.js\";\nimport \"core-js/modules/es.typed-array.copy-within.js\";\nimport \"core-js/modules/es.typed-array.every.js\";\nimport \"core-js/modules/es.typed-array.fill.js\";\nimport \"core-js/modules/es.typed-array.filter.js\";\nimport \"core-js/modules/es.typed-array.find.js\";\nimport \"core-js/modules/es.typed-array.find-index.js\";\nimport \"core-js/modules/es.typed-array.for-each.js\";\nimport \"core-js/modules/es.typed-array.includes.js\";\nimport \"core-js/modules/es.typed-array.index-of.js\";\nimport \"core-js/modules/es.typed-array.iterator.js\";\nimport \"core-js/modules/es.typed-array.join.js\";\nimport \"core-js/modules/es.typed-array.last-index-of.js\";\nimport \"core-js/modules/es.typed-array.map.js\";\nimport \"core-js/modules/es.typed-array.reduce.js\";\nimport \"core-js/modules/es.typed-array.reduce-right.js\";\nimport \"core-js/modules/es.typed-array.reverse.js\";\nimport \"core-js/modules/es.typed-array.set.js\";\nimport \"core-js/modules/es.typed-array.slice.js\";\nimport \"core-js/modules/es.typed-array.some.js\";\nimport \"core-js/modules/es.typed-array.sort.js\";\nimport \"core-js/modules/es.typed-array.subarray.js\";\nimport \"core-js/modules/es.typed-array.to-locale-string.js\";\nimport \"core-js/modules/es.typed-array.to-string.js\";\nimport \"core-js/modules/es.typed-array.float32-array.js\";\nimport \"core-js/modules/web.timers.js\";\nimport \"core-js/modules/es.error.to-string.js\";\nimport \"core-js/modules/web.atob.js\";\nimport \"core-js/modules/web.dom-exception.constructor.js\";\nimport \"core-js/modules/web.dom-exception.stack.js\";\nimport \"core-js/modules/web.dom-exception.to-string-tag.js\";\nimport \"core-js/modules/es.string.split.js\";\nimport \"core-js/modules/es.date.to-string.js\";\nimport \"core-js/modules/es.array.slice.js\";\nimport \"core-js/modules/es.object.get-prototype-of.js\";\nimport \"core-js/modules/es.regexp.test.js\";\nimport \"core-js/modules/es.error.cause.js\";\nimport { __awaiter, __generator } from \"tslib\";\nimport { Observable } from \"./observable.js\";\nimport { GetDOMTextContent, IsNavigatorAvailable, IsWindowObjectExist } from \"./domManagement.js\";\nimport { Logger } from \"./logger.js\";\nimport { DeepCopier } from \"./deepCopier.js\";\nimport { PrecisionDate } from \"./precisionDate.js\";\nimport { _WarnImport } from \"./devTools.js\";\nimport { WebRequest } from \"./webRequest.js\";\nimport { EngineStore } from \"../Engines/engineStore.js\";\nimport { FileToolsOptions, DecodeBase64UrlToBinary, IsBase64DataUrl, LoadFile as FileToolsLoadFile, LoadImage as FileToolLoadImage, ReadFile as FileToolsReadFile, SetCorsBehavior } from \"./fileTools.js\";\nimport { PromisePolyfill } from \"./promise.js\";\nimport { TimingTools } from \"./timingTools.js\";\nimport { InstantiationTools } from \"./instantiationTools.js\";\nimport { RandomGUID } from \"./guid.js\";\nimport { SliceTools } from \"./sliceTools.js\";\n/**\n * Class containing a set of static utilities functions\n */\n\nvar Tools =\n/** @class */\nfunction () {\n  function Tools() {}\n\n  Object.defineProperty(Tools, \"BaseUrl\", {\n    /**\n     * Gets or sets the base URL to use to load assets\n     */\n    get: function get() {\n      return FileToolsOptions.BaseUrl;\n    },\n    set: function set(value) {\n      FileToolsOptions.BaseUrl = value;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Tools, \"DefaultRetryStrategy\", {\n    /**\n     * Gets or sets the retry strategy to apply when an error happens while loading an asset\n     */\n    get: function get() {\n      return FileToolsOptions.DefaultRetryStrategy;\n    },\n    set: function set(strategy) {\n      FileToolsOptions.DefaultRetryStrategy = strategy;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Tools, \"CorsBehavior\", {\n    /**\n     * Default behaviour for cors in the application.\n     * It can be a string if the expected behavior is identical in the entire app.\n     * Or a callback to be able to set it per url or on a group of them (in case of Video source for instance)\n     */\n    get: function get() {\n      return FileToolsOptions.CorsBehavior;\n    },\n    set: function set(value) {\n      FileToolsOptions.CorsBehavior = value;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Tools, \"UseFallbackTexture\", {\n    /**\n     * Gets or sets a global variable indicating if fallback texture must be used when a texture cannot be loaded\n     * @ignorenaming\n     */\n    get: function get() {\n      return EngineStore.UseFallbackTexture;\n    },\n    set: function set(value) {\n      EngineStore.UseFallbackTexture = value;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Tools, \"RegisteredExternalClasses\", {\n    /**\n     * Use this object to register external classes like custom textures or material\n     * to allow the loaders to instantiate them\n     */\n    get: function get() {\n      return InstantiationTools.RegisteredExternalClasses;\n    },\n    set: function set(classes) {\n      InstantiationTools.RegisteredExternalClasses = classes;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Tools, \"fallbackTexture\", {\n    /**\n     * Texture content used if a texture cannot loaded\n     * @ignorenaming\n     */\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    get: function get() {\n      return EngineStore.FallbackTexture;\n    },\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    set: function set(value) {\n      EngineStore.FallbackTexture = value;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\n   * Read the content of a byte array at a specified coordinates (taking in account wrapping)\n   * @param u defines the coordinate on X axis\n   * @param v defines the coordinate on Y axis\n   * @param width defines the width of the source data\n   * @param height defines the height of the source data\n   * @param pixels defines the source byte array\n   * @param color defines the output color\n   */\n\n  Tools.FetchToRef = function (u, v, width, height, pixels, color) {\n    var wrappedU = Math.abs(u) * width % width | 0;\n    var wrappedV = Math.abs(v) * height % height | 0;\n    var position = (wrappedU + wrappedV * width) * 4;\n    color.r = pixels[position] / 255;\n    color.g = pixels[position + 1] / 255;\n    color.b = pixels[position + 2] / 255;\n    color.a = pixels[position + 3] / 255;\n  };\n  /**\n   * Interpolates between a and b via alpha\n   * @param a The lower value (returned when alpha = 0)\n   * @param b The upper value (returned when alpha = 1)\n   * @param alpha The interpolation-factor\n   * @return The mixed value\n   */\n\n\n  Tools.Mix = function (a, b, alpha) {\n    return a * (1 - alpha) + b * alpha;\n  };\n  /**\n   * Tries to instantiate a new object from a given class name\n   * @param className defines the class name to instantiate\n   * @returns the new object or null if the system was not able to do the instantiation\n   */\n\n\n  Tools.Instantiate = function (className) {\n    return InstantiationTools.Instantiate(className);\n  };\n  /**\n   * Provides a slice function that will work even on IE\n   * @param data defines the array to slice\n   * @param start defines the start of the data (optional)\n   * @param end defines the end of the data (optional)\n   * @returns the new sliced array\n   */\n\n\n  Tools.Slice = function (data, start, end) {\n    return SliceTools.Slice(data, start, end);\n  };\n  /**\n   * Provides a slice function that will work even on IE\n   * The difference between this and Slice is that this will force-convert to array\n   * @param data defines the array to slice\n   * @param start defines the start of the data (optional)\n   * @param end defines the end of the data (optional)\n   * @returns the new sliced array\n   */\n\n\n  Tools.SliceToArray = function (data, start, end) {\n    return SliceTools.SliceToArray(data, start, end);\n  };\n  /**\n   * Polyfill for setImmediate\n   * @param action defines the action to execute after the current execution block\n   */\n\n\n  Tools.SetImmediate = function (action) {\n    TimingTools.SetImmediate(action);\n  };\n  /**\n   * Function indicating if a number is an exponent of 2\n   * @param value defines the value to test\n   * @returns true if the value is an exponent of 2\n   */\n\n\n  Tools.IsExponentOfTwo = function (value) {\n    var count = 1;\n\n    do {\n      count *= 2;\n    } while (count < value);\n\n    return count === value;\n  };\n  /**\n   * Returns the nearest 32-bit single precision float representation of a Number\n   * @param value A Number.  If the parameter is of a different type, it will get converted\n   * to a number or to NaN if it cannot be converted\n   * @returns number\n   */\n\n\n  Tools.FloatRound = function (value) {\n    if (Math.fround) {\n      return Math.fround(value);\n    }\n\n    return Tools._TmpFloatArray[0] = value, Tools._TmpFloatArray[0];\n  };\n  /**\n   * Extracts the filename from a path\n   * @param path defines the path to use\n   * @returns the filename\n   */\n\n\n  Tools.GetFilename = function (path) {\n    var index = path.lastIndexOf(\"/\");\n\n    if (index < 0) {\n      return path;\n    }\n\n    return path.substring(index + 1);\n  };\n  /**\n   * Extracts the \"folder\" part of a path (everything before the filename).\n   * @param uri The URI to extract the info from\n   * @param returnUnchangedIfNoSlash Do not touch the URI if no slashes are present\n   * @returns The \"folder\" part of the path\n   */\n\n\n  Tools.GetFolderPath = function (uri, returnUnchangedIfNoSlash) {\n    if (returnUnchangedIfNoSlash === void 0) {\n      returnUnchangedIfNoSlash = false;\n    }\n\n    var index = uri.lastIndexOf(\"/\");\n\n    if (index < 0) {\n      if (returnUnchangedIfNoSlash) {\n        return uri;\n      }\n\n      return \"\";\n    }\n\n    return uri.substring(0, index + 1);\n  };\n  /**\n   * Convert an angle in radians to degrees\n   * @param angle defines the angle to convert\n   * @returns the angle in degrees\n   */\n\n\n  Tools.ToDegrees = function (angle) {\n    return angle * 180 / Math.PI;\n  };\n  /**\n   * Convert an angle in degrees to radians\n   * @param angle defines the angle to convert\n   * @returns the angle in radians\n   */\n\n\n  Tools.ToRadians = function (angle) {\n    return angle * Math.PI / 180;\n  };\n  /**\n   * Returns an array if obj is not an array\n   * @param obj defines the object to evaluate as an array\n   * @param allowsNullUndefined defines a boolean indicating if obj is allowed to be null or undefined\n   * @returns either obj directly if obj is an array or a new array containing obj\n   */\n\n\n  Tools.MakeArray = function (obj, allowsNullUndefined) {\n    if (allowsNullUndefined !== true && (obj === undefined || obj == null)) {\n      return null;\n    }\n\n    return Array.isArray(obj) ? obj : [obj];\n  };\n  /**\n   * Gets the pointer prefix to use\n   * @param engine defines the engine we are finding the prefix for\n   * @returns \"pointer\" if touch is enabled. Else returns \"mouse\"\n   */\n\n\n  Tools.GetPointerPrefix = function (engine) {\n    var eventPrefix = \"pointer\"; // Check if pointer events are supported\n\n    if (IsWindowObjectExist() && !window.PointerEvent) {\n      eventPrefix = \"mouse\";\n    } // Special Fallback MacOS Safari...\n\n\n    if (engine._badDesktopOS && !engine._badOS && // And not ipad pros who claim to be macs...\n    !(document && \"ontouchend\" in document)) {\n      eventPrefix = \"mouse\";\n    }\n\n    return eventPrefix;\n  };\n  /**\n   * Sets the cors behavior on a dom element. This will add the required Tools.CorsBehavior to the element.\n   * @param url define the url we are trying\n   * @param element define the dom element where to configure the cors policy\n   * @param element.crossOrigin\n   */\n\n\n  Tools.SetCorsBehavior = function (url, element) {\n    SetCorsBehavior(url, element);\n  }; // External files\n\n  /**\n   * Removes unwanted characters from an url\n   * @param url defines the url to clean\n   * @returns the cleaned url\n   */\n\n\n  Tools.CleanUrl = function (url) {\n    url = url.replace(/#/gm, \"%23\");\n    return url;\n  };\n\n  Object.defineProperty(Tools, \"PreprocessUrl\", {\n    /**\n     * Gets or sets a function used to pre-process url before using them to load assets\n     */\n    get: function get() {\n      return FileToolsOptions.PreprocessUrl;\n    },\n    set: function set(processor) {\n      FileToolsOptions.PreprocessUrl = processor;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\n   * Loads an image as an HTMLImageElement.\n   * @param input url string, ArrayBuffer, or Blob to load\n   * @param onLoad callback called when the image successfully loads\n   * @param onError callback called when the image fails to load\n   * @param offlineProvider offline provider for caching\n   * @param mimeType optional mime type\n   * @param imageBitmapOptions optional the options to use when creating an ImageBitmap\n   * @returns the HTMLImageElement of the loaded image\n   */\n\n  Tools.LoadImage = function (input, onLoad, onError, offlineProvider, mimeType, imageBitmapOptions) {\n    return FileToolLoadImage(input, onLoad, onError, offlineProvider, mimeType, imageBitmapOptions);\n  };\n  /**\n   * Loads a file from a url\n   * @param url url string, ArrayBuffer, or Blob to load\n   * @param onSuccess callback called when the file successfully loads\n   * @param onProgress callback called while file is loading (if the server supports this mode)\n   * @param offlineProvider defines the offline provider for caching\n   * @param useArrayBuffer defines a boolean indicating that date must be returned as ArrayBuffer\n   * @param onError callback called when the file fails to load\n   * @returns a file request object\n   */\n\n\n  Tools.LoadFile = function (url, onSuccess, onProgress, offlineProvider, useArrayBuffer, onError) {\n    return FileToolsLoadFile(url, onSuccess, onProgress, offlineProvider, useArrayBuffer, onError);\n  };\n  /**\n   * Loads a file from a url\n   * @param url the file url to load\n   * @param useArrayBuffer defines a boolean indicating that date must be returned as ArrayBuffer\n   * @returns a promise containing an ArrayBuffer corresponding to the loaded file\n   */\n\n\n  Tools.LoadFileAsync = function (url, useArrayBuffer) {\n    if (useArrayBuffer === void 0) {\n      useArrayBuffer = true;\n    }\n\n    return new Promise(function (resolve, reject) {\n      FileToolsLoadFile(url, function (data) {\n        resolve(data);\n      }, undefined, undefined, useArrayBuffer, function (request, exception) {\n        reject(exception);\n      });\n    });\n  };\n  /**\n   * Load a script (identified by an url). When the url returns, the\n   * content of this file is added into a new script element, attached to the DOM (body element)\n   * @param scriptUrl defines the url of the script to laod\n   * @param onSuccess defines the callback called when the script is loaded\n   * @param onError defines the callback to call if an error occurs\n   * @param scriptId defines the id of the script element\n   */\n\n\n  Tools.LoadScript = function (scriptUrl, onSuccess, onError, scriptId) {\n    if (!IsWindowObjectExist()) {\n      return;\n    }\n\n    var head = document.getElementsByTagName(\"head\")[0];\n    var script = document.createElement(\"script\");\n    script.setAttribute(\"type\", \"text/javascript\");\n    script.setAttribute(\"src\", scriptUrl);\n\n    if (scriptId) {\n      script.id = scriptId;\n    }\n\n    script.onload = function () {\n      if (onSuccess) {\n        onSuccess();\n      }\n    };\n\n    script.onerror = function (e) {\n      if (onError) {\n        onError(\"Unable to load script '\".concat(scriptUrl, \"'\"), e);\n      }\n    };\n\n    head.appendChild(script);\n  };\n  /**\n   * Load an asynchronous script (identified by an url). When the url returns, the\n   * content of this file is added into a new script element, attached to the DOM (body element)\n   * @param scriptUrl defines the url of the script to laod\n   * @returns a promise request object\n   */\n\n\n  Tools.LoadScriptAsync = function (scriptUrl) {\n    var _this = this;\n\n    return new Promise(function (resolve, reject) {\n      _this.LoadScript(scriptUrl, function () {\n        resolve();\n      }, function (message, exception) {\n        reject(exception);\n      });\n    });\n  };\n  /**\n   * Loads a file from a blob\n   * @param fileToLoad defines the blob to use\n   * @param callback defines the callback to call when data is loaded\n   * @param progressCallback defines the callback to call during loading process\n   * @returns a file request object\n   */\n\n\n  Tools.ReadFileAsDataURL = function (fileToLoad, callback, progressCallback) {\n    var reader = new FileReader();\n    var request = {\n      onCompleteObservable: new Observable(),\n      abort: function abort() {\n        return reader.abort();\n      }\n    };\n\n    reader.onloadend = function () {\n      request.onCompleteObservable.notifyObservers(request);\n    };\n\n    reader.onload = function (e) {\n      //target doesn't have result from ts 1.3\n      callback(e.target[\"result\"]);\n    };\n\n    reader.onprogress = progressCallback;\n    reader.readAsDataURL(fileToLoad);\n    return request;\n  };\n  /**\n   * Reads a file from a File object\n   * @param file defines the file to load\n   * @param onSuccess defines the callback to call when data is loaded\n   * @param onProgress defines the callback to call during loading process\n   * @param useArrayBuffer defines a boolean indicating that data must be returned as an ArrayBuffer\n   * @param onError defines the callback to call when an error occurs\n   * @returns a file request object\n   */\n\n\n  Tools.ReadFile = function (file, onSuccess, onProgress, useArrayBuffer, onError) {\n    return FileToolsReadFile(file, onSuccess, onProgress, useArrayBuffer, onError);\n  };\n  /**\n   * Creates a data url from a given string content\n   * @param content defines the content to convert\n   * @returns the new data url link\n   */\n\n\n  Tools.FileAsURL = function (content) {\n    var fileBlob = new Blob([content]);\n    var url = window.URL || window.webkitURL;\n    var link = url.createObjectURL(fileBlob);\n    return link;\n  };\n  /**\n   * Format the given number to a specific decimal format\n   * @param value defines the number to format\n   * @param decimals defines the number of decimals to use\n   * @returns the formatted string\n   */\n\n\n  Tools.Format = function (value, decimals) {\n    if (decimals === void 0) {\n      decimals = 2;\n    }\n\n    return value.toFixed(decimals);\n  };\n  /**\n   * Tries to copy an object by duplicating every property\n   * @param source defines the source object\n   * @param destination defines the target object\n   * @param doNotCopyList defines a list of properties to avoid\n   * @param mustCopyList defines a list of properties to copy (even if they start with _)\n   */\n\n\n  Tools.DeepCopy = function (source, destination, doNotCopyList, mustCopyList) {\n    DeepCopier.DeepCopy(source, destination, doNotCopyList, mustCopyList);\n  };\n  /**\n   * Gets a boolean indicating if the given object has no own property\n   * @param obj defines the object to test\n   * @returns true if object has no own property\n   */\n\n\n  Tools.IsEmpty = function (obj) {\n    for (var i in obj) {\n      if (Object.prototype.hasOwnProperty.call(obj, i)) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n  /**\n   * Function used to register events at window level\n   * @param windowElement defines the Window object to use\n   * @param events defines the events to register\n   */\n\n\n  Tools.RegisterTopRootEvents = function (windowElement, events) {\n    for (var index = 0; index < events.length; index++) {\n      var event_1 = events[index];\n      windowElement.addEventListener(event_1.name, event_1.handler, false);\n\n      try {\n        if (window.parent) {\n          window.parent.addEventListener(event_1.name, event_1.handler, false);\n        }\n      } catch (e) {// Silently fails...\n      }\n    }\n  };\n  /**\n   * Function used to unregister events from window level\n   * @param windowElement defines the Window object to use\n   * @param events defines the events to unregister\n   */\n\n\n  Tools.UnregisterTopRootEvents = function (windowElement, events) {\n    for (var index = 0; index < events.length; index++) {\n      var event_2 = events[index];\n      windowElement.removeEventListener(event_2.name, event_2.handler);\n\n      try {\n        if (windowElement.parent) {\n          windowElement.parent.removeEventListener(event_2.name, event_2.handler);\n        }\n      } catch (e) {// Silently fails...\n      }\n    }\n  };\n  /**\n   * Dumps the current bound framebuffer\n   * @param width defines the rendering width\n   * @param height defines the rendering height\n   * @param engine defines the hosting engine\n   * @param successCallback defines the callback triggered once the data are available\n   * @param mimeType defines the mime type of the result\n   * @param fileName defines the filename to download. If present, the result will automatically be downloaded\n   * @return a void promise\n   */\n\n\n  Tools.DumpFramebuffer = function (width, height, engine, successCallback, mimeType, fileName) {\n    if (mimeType === void 0) {\n      mimeType = \"image/png\";\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var bufferView, data;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , engine.readPixels(0, 0, width, height)];\n\n          case 1:\n            bufferView = _a.sent();\n            data = new Uint8Array(bufferView.buffer);\n            Tools.DumpData(width, height, data, successCallback, mimeType, fileName, true);\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n  /**\n   * Dumps an array buffer\n   * @param width defines the rendering width\n   * @param height defines the rendering height\n   * @param data the data array\n   * @param successCallback defines the callback triggered once the data are available\n   * @param mimeType defines the mime type of the result\n   * @param fileName defines the filename to download. If present, the result will automatically be downloaded\n   * @param invertY true to invert the picture in the Y dimension\n   * @param toArrayBuffer true to convert the data to an ArrayBuffer (encoded as `mimeType`) instead of a base64 string\n   * @param quality defines the quality of the result\n   */\n\n\n  Tools.DumpData = function (width, height, data, successCallback, mimeType, fileName, invertY, toArrayBuffer, quality) {\n    if (mimeType === void 0) {\n      mimeType = \"image/png\";\n    }\n\n    if (invertY === void 0) {\n      invertY = false;\n    }\n\n    if (toArrayBuffer === void 0) {\n      toArrayBuffer = false;\n    } // Create a 2D canvas to store the result\n\n\n    if (!Tools._ScreenshotCanvas) {\n      Tools._ScreenshotCanvas = document.createElement(\"canvas\");\n    }\n\n    Tools._ScreenshotCanvas.width = width;\n    Tools._ScreenshotCanvas.height = height;\n\n    var context = Tools._ScreenshotCanvas.getContext(\"2d\");\n\n    if (context) {\n      // Convert if data are float32\n      if (data instanceof Float32Array) {\n        var data2 = new Uint8Array(data.length);\n        var n = data.length;\n\n        while (n--) {\n          var v = data[n];\n          data2[n] = v < 0 ? 0 : v > 1 ? 1 : Math.round(v * 255);\n        }\n\n        data = data2;\n      } // Copy the pixels to a 2D canvas\n\n\n      var imageData = context.createImageData(width, height);\n      var castData = imageData.data;\n      castData.set(data);\n      context.putImageData(imageData, 0, 0);\n      var canvas = Tools._ScreenshotCanvas;\n\n      if (invertY) {\n        var canvas2 = document.createElement(\"canvas\");\n        canvas2.width = width;\n        canvas2.height = height;\n        var ctx2 = canvas2.getContext(\"2d\");\n\n        if (!ctx2) {\n          return;\n        }\n\n        ctx2.translate(0, height);\n        ctx2.scale(1, -1);\n        ctx2.drawImage(Tools._ScreenshotCanvas, 0, 0);\n        canvas = canvas2;\n      }\n\n      if (toArrayBuffer) {\n        Tools.ToBlob(canvas, function (blob) {\n          var fileReader = new FileReader();\n\n          fileReader.onload = function (event) {\n            var arrayBuffer = event.target.result;\n\n            if (successCallback) {\n              successCallback(arrayBuffer);\n            }\n          };\n\n          fileReader.readAsArrayBuffer(blob);\n        }, mimeType, quality);\n      } else {\n        Tools.EncodeScreenshotCanvasData(successCallback, mimeType, fileName, canvas, quality);\n      }\n    }\n  };\n  /**\n   * Dumps an array buffer\n   * @param width defines the rendering width\n   * @param height defines the rendering height\n   * @param data the data array\n   * @param mimeType defines the mime type of the result\n   * @param fileName defines the filename to download. If present, the result will automatically be downloaded\n   * @param invertY true to invert the picture in the Y dimension\n   * @param toArrayBuffer true to convert the data to an ArrayBuffer (encoded as `mimeType`) instead of a base64 string\n   * @param quality defines the quality of the result\n   * @return a promise that resolve to the final data\n   */\n\n\n  Tools.DumpDataAsync = function (width, height, data, mimeType, fileName, invertY, toArrayBuffer, quality) {\n    if (mimeType === void 0) {\n      mimeType = \"image/png\";\n    }\n\n    if (invertY === void 0) {\n      invertY = false;\n    }\n\n    if (toArrayBuffer === void 0) {\n      toArrayBuffer = false;\n    }\n\n    return new Promise(function (resolve) {\n      Tools.DumpData(width, height, data, function (result) {\n        return resolve(result);\n      }, mimeType, fileName, invertY, toArrayBuffer, quality);\n    });\n  };\n  /**\n   * Converts the canvas data to blob.\n   * This acts as a polyfill for browsers not supporting the to blob function.\n   * @param canvas Defines the canvas to extract the data from\n   * @param successCallback Defines the callback triggered once the data are available\n   * @param mimeType Defines the mime type of the result\n   * @param quality defines the quality of the result\n   */\n\n\n  Tools.ToBlob = function (canvas, successCallback, mimeType, quality) {\n    if (mimeType === void 0) {\n      mimeType = \"image/png\";\n    } // We need HTMLCanvasElement.toBlob for HD screenshots\n\n\n    if (!canvas.toBlob) {\n      //  low performance polyfill based on toDataURL (https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob)\n      canvas.toBlob = function (callback, type, quality) {\n        var _this = this;\n\n        setTimeout(function () {\n          var binStr = atob(_this.toDataURL(type, quality).split(\",\")[1]),\n              len = binStr.length,\n              arr = new Uint8Array(len);\n\n          for (var i = 0; i < len; i++) {\n            arr[i] = binStr.charCodeAt(i);\n          }\n\n          callback(new Blob([arr]));\n        });\n      };\n    }\n\n    canvas.toBlob(function (blob) {\n      successCallback(blob);\n    }, mimeType, quality);\n  };\n  /**\n   * Encodes the canvas data to base 64 or automatically download the result if filename is defined\n   * @param successCallback defines the callback triggered once the data are available\n   * @param mimeType defines the mime type of the result\n   * @param fileName defines he filename to download. If present, the result will automatically be downloaded\n   * @param canvas canvas to get the data from. If not provided, use the default screenshot canvas\n   * @param quality defines the quality of the result\n   */\n\n\n  Tools.EncodeScreenshotCanvasData = function (successCallback, mimeType, fileName, canvas, quality) {\n    if (mimeType === void 0) {\n      mimeType = \"image/png\";\n    }\n\n    if (successCallback) {\n      var base64Image = (canvas !== null && canvas !== void 0 ? canvas : Tools._ScreenshotCanvas).toDataURL(mimeType, quality);\n      successCallback(base64Image);\n    } else {\n      this.ToBlob(canvas !== null && canvas !== void 0 ? canvas : Tools._ScreenshotCanvas, function (blob) {\n        //Creating a link if the browser have the download attribute on the a tag, to automatically start download generated image.\n        if (\"download\" in document.createElement(\"a\")) {\n          if (!fileName) {\n            var date = new Date();\n            var stringDate = (date.getFullYear() + \"-\" + (date.getMonth() + 1)).slice(2) + \"-\" + date.getDate() + \"_\" + date.getHours() + \"-\" + (\"0\" + date.getMinutes()).slice(-2);\n            fileName = \"screenshot_\" + stringDate + \".png\";\n          }\n\n          Tools.Download(blob, fileName);\n        } else {\n          if (blob) {\n            var url_1 = URL.createObjectURL(blob);\n            var newWindow = window.open(\"\");\n\n            if (!newWindow) {\n              return;\n            }\n\n            var img = newWindow.document.createElement(\"img\");\n\n            img.onload = function () {\n              // no longer need to read the blob so it's revoked\n              URL.revokeObjectURL(url_1);\n            };\n\n            img.src = url_1;\n            newWindow.document.body.appendChild(img);\n          }\n        }\n      }, mimeType, quality);\n    }\n  };\n  /**\n   * Downloads a blob in the browser\n   * @param blob defines the blob to download\n   * @param fileName defines the name of the downloaded file\n   */\n\n\n  Tools.Download = function (blob, fileName) {\n    if (navigator && navigator.msSaveBlob) {\n      navigator.msSaveBlob(blob, fileName);\n      return;\n    }\n\n    var url = window.URL.createObjectURL(blob);\n    var a = document.createElement(\"a\");\n    document.body.appendChild(a);\n    a.style.display = \"none\";\n    a.href = url;\n    a.download = fileName;\n    a.addEventListener(\"click\", function () {\n      if (a.parentElement) {\n        a.parentElement.removeChild(a);\n      }\n    });\n    a.click();\n    window.URL.revokeObjectURL(url);\n  };\n  /**\n   * Will return the right value of the noPreventDefault variable\n   * Needed to keep backwards compatibility to the old API.\n   *\n   * @param args arguments passed to the attachControl function\n   * @returns the correct value for noPreventDefault\n   */\n\n\n  Tools.BackCompatCameraNoPreventDefault = function (args) {\n    // is it used correctly?\n    if (typeof args[0] === \"boolean\") {\n      return args[0];\n    } else if (typeof args[1] === \"boolean\") {\n      return args[1];\n    }\n\n    return false;\n  };\n  /**\n   * Captures a screenshot of the current rendering\n   * @see https://doc.babylonjs.com/how_to/render_scene_on_a_png\n   * @param engine defines the rendering engine\n   * @param camera defines the source camera\n   * @param size This parameter can be set to a single number or to an object with the\n   * following (optional) properties: precision, width, height. If a single number is passed,\n   * it will be used for both width and height. If an object is passed, the screenshot size\n   * will be derived from the parameters. The precision property is a multiplier allowing\n   * rendering at a higher or lower resolution\n   * @param successCallback defines the callback receives a single parameter which contains the\n   * screenshot as a string of base64-encoded characters. This string can be assigned to the\n   * src parameter of an <img> to display it\n   * @param mimeType defines the MIME type of the screenshot image (default: image/png).\n   * Check your browser for supported MIME types\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  Tools.CreateScreenshot = function (engine, camera, size, successCallback, mimeType) {\n    if (mimeType === void 0) {\n      mimeType = \"image/png\";\n    }\n\n    throw _WarnImport(\"ScreenshotTools\");\n  };\n  /**\n   * Captures a screenshot of the current rendering\n   * @see https://doc.babylonjs.com/how_to/render_scene_on_a_png\n   * @param engine defines the rendering engine\n   * @param camera defines the source camera\n   * @param size This parameter can be set to a single number or to an object with the\n   * following (optional) properties: precision, width, height. If a single number is passed,\n   * it will be used for both width and height. If an object is passed, the screenshot size\n   * will be derived from the parameters. The precision property is a multiplier allowing\n   * rendering at a higher or lower resolution\n   * @param mimeType defines the MIME type of the screenshot image (default: image/png).\n   * Check your browser for supported MIME types\n   * @returns screenshot as a string of base64-encoded characters. This string can be assigned\n   * to the src parameter of an <img> to display it\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  Tools.CreateScreenshotAsync = function (engine, camera, size, mimeType) {\n    if (mimeType === void 0) {\n      mimeType = \"image/png\";\n    }\n\n    throw _WarnImport(\"ScreenshotTools\");\n  };\n  /**\n   * Generates an image screenshot from the specified camera.\n   * @see https://doc.babylonjs.com/how_to/render_scene_on_a_png\n   * @param engine The engine to use for rendering\n   * @param camera The camera to use for rendering\n   * @param size This parameter can be set to a single number or to an object with the\n   * following (optional) properties: precision, width, height. If a single number is passed,\n   * it will be used for both width and height. If an object is passed, the screenshot size\n   * will be derived from the parameters. The precision property is a multiplier allowing\n   * rendering at a higher or lower resolution\n   * @param successCallback The callback receives a single parameter which contains the\n   * screenshot as a string of base64-encoded characters. This string can be assigned to the\n   * src parameter of an <img> to display it\n   * @param mimeType The MIME type of the screenshot image (default: image/png).\n   * Check your browser for supported MIME types\n   * @param samples Texture samples (default: 1)\n   * @param antialiasing Whether antialiasing should be turned on or not (default: false)\n   * @param fileName A name for for the downloaded file.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  Tools.CreateScreenshotUsingRenderTarget = function (engine, camera, size, successCallback, mimeType, samples, antialiasing, fileName) {\n    if (mimeType === void 0) {\n      mimeType = \"image/png\";\n    }\n\n    if (samples === void 0) {\n      samples = 1;\n    }\n\n    if (antialiasing === void 0) {\n      antialiasing = false;\n    }\n\n    throw _WarnImport(\"ScreenshotTools\");\n  };\n  /**\n   * Generates an image screenshot from the specified camera.\n   * @see https://doc.babylonjs.com/how_to/render_scene_on_a_png\n   * @param engine The engine to use for rendering\n   * @param camera The camera to use for rendering\n   * @param size This parameter can be set to a single number or to an object with the\n   * following (optional) properties: precision, width, height. If a single number is passed,\n   * it will be used for both width and height. If an object is passed, the screenshot size\n   * will be derived from the parameters. The precision property is a multiplier allowing\n   * rendering at a higher or lower resolution\n   * @param mimeType The MIME type of the screenshot image (default: image/png).\n   * Check your browser for supported MIME types\n   * @param samples Texture samples (default: 1)\n   * @param antialiasing Whether antialiasing should be turned on or not (default: false)\n   * @param fileName A name for for the downloaded file.\n   * @returns screenshot as a string of base64-encoded characters. This string can be assigned\n   * to the src parameter of an <img> to display it\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  Tools.CreateScreenshotUsingRenderTargetAsync = function (engine, camera, size, mimeType, samples, antialiasing, fileName) {\n    if (mimeType === void 0) {\n      mimeType = \"image/png\";\n    }\n\n    if (samples === void 0) {\n      samples = 1;\n    }\n\n    if (antialiasing === void 0) {\n      antialiasing = false;\n    }\n\n    throw _WarnImport(\"ScreenshotTools\");\n  };\n  /**\n   * Implementation from http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/2117523#answer-2117523\n   * Be aware Math.random() could cause collisions, but:\n   * \"All but 6 of the 128 bits of the ID are randomly generated, which means that for any two ids, there's a 1 in 2^^122 (or 5.3x10^^36) chance they'll collide\"\n   * @returns a pseudo random id\n   */\n\n\n  Tools.RandomId = function () {\n    return RandomGUID();\n  };\n  /**\n   * Test if the given uri is a base64 string\n   * @deprecated Please use FileTools.IsBase64DataUrl instead.\n   * @param uri The uri to test\n   * @return True if the uri is a base64 string or false otherwise\n   */\n\n\n  Tools.IsBase64 = function (uri) {\n    return IsBase64DataUrl(uri);\n  };\n  /**\n   * Decode the given base64 uri.\n   * @deprecated Please use FileTools.DecodeBase64UrlToBinary instead.\n   * @param uri The uri to decode\n   * @return The decoded base64 data.\n   */\n\n\n  Tools.DecodeBase64 = function (uri) {\n    return DecodeBase64UrlToBinary(uri);\n  };\n\n  Object.defineProperty(Tools, \"errorsCount\", {\n    /**\n     * Gets a value indicating the number of loading errors\n     * @ignorenaming\n     */\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    get: function get() {\n      return Logger.errorsCount;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\n   * Log a message to the console\n   * @param message defines the message to log\n   */\n\n  Tools.Log = function (message) {\n    Logger.Log(message);\n  };\n  /**\n   * Write a warning message to the console\n   * @param message defines the message to log\n   */\n\n\n  Tools.Warn = function (message) {\n    Logger.Warn(message);\n  };\n  /**\n   * Write an error message to the console\n   * @param message defines the message to log\n   */\n\n\n  Tools.Error = function (message) {\n    Logger.Error(message);\n  };\n\n  Object.defineProperty(Tools, \"LogCache\", {\n    /**\n     * Gets current log cache (list of logs)\n     */\n    get: function get() {\n      return Logger.LogCache;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\n   * Clears the log cache\n   */\n\n  Tools.ClearLogCache = function () {\n    Logger.ClearLogCache();\n  };\n\n  Object.defineProperty(Tools, \"LogLevels\", {\n    /**\n     * Sets the current log level (MessageLogLevel / WarningLogLevel / ErrorLogLevel)\n     */\n    set: function set(level) {\n      Logger.LogLevels = level;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Tools, \"PerformanceLogLevel\", {\n    /**\n     * Sets the current performance log level\n     */\n    set: function set(level) {\n      if ((level & Tools.PerformanceUserMarkLogLevel) === Tools.PerformanceUserMarkLogLevel) {\n        Tools.StartPerformanceCounter = Tools._StartUserMark;\n        Tools.EndPerformanceCounter = Tools._EndUserMark;\n        return;\n      }\n\n      if ((level & Tools.PerformanceConsoleLogLevel) === Tools.PerformanceConsoleLogLevel) {\n        Tools.StartPerformanceCounter = Tools._StartPerformanceConsole;\n        Tools.EndPerformanceCounter = Tools._EndPerformanceConsole;\n        return;\n      }\n\n      Tools.StartPerformanceCounter = Tools._StartPerformanceCounterDisabled;\n      Tools.EndPerformanceCounter = Tools._EndPerformanceCounterDisabled;\n    },\n    enumerable: false,\n    configurable: true\n  }); // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n  Tools._StartPerformanceCounterDisabled = function (counterName, condition) {}; // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  Tools._EndPerformanceCounterDisabled = function (counterName, condition) {};\n\n  Tools._StartUserMark = function (counterName, condition) {\n    if (condition === void 0) {\n      condition = true;\n    }\n\n    if (!Tools._Performance) {\n      if (!IsWindowObjectExist()) {\n        return;\n      }\n\n      Tools._Performance = window.performance;\n    }\n\n    if (!condition || !Tools._Performance.mark) {\n      return;\n    }\n\n    Tools._Performance.mark(counterName + \"-Begin\");\n  };\n\n  Tools._EndUserMark = function (counterName, condition) {\n    if (condition === void 0) {\n      condition = true;\n    }\n\n    if (!condition || !Tools._Performance.mark) {\n      return;\n    }\n\n    Tools._Performance.mark(counterName + \"-End\");\n\n    Tools._Performance.measure(counterName, counterName + \"-Begin\", counterName + \"-End\");\n  };\n\n  Tools._StartPerformanceConsole = function (counterName, condition) {\n    if (condition === void 0) {\n      condition = true;\n    }\n\n    if (!condition) {\n      return;\n    }\n\n    Tools._StartUserMark(counterName, condition);\n\n    if (console.time) {\n      console.time(counterName);\n    }\n  };\n\n  Tools._EndPerformanceConsole = function (counterName, condition) {\n    if (condition === void 0) {\n      condition = true;\n    }\n\n    if (!condition) {\n      return;\n    }\n\n    Tools._EndUserMark(counterName, condition);\n\n    console.timeEnd(counterName);\n  };\n\n  Object.defineProperty(Tools, \"Now\", {\n    /**\n     * Gets either window.performance.now() if supported or Date.now() else\n     */\n    get: function get() {\n      return PrecisionDate.Now;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\n   * This method will return the name of the class used to create the instance of the given object.\n   * It will works only on Javascript basic data types (number, string, ...) and instance of class declared with the @className decorator.\n   * @param object the object to get the class name from\n   * @param isType defines if the object is actually a type\n   * @returns the name of the class, will be \"object\" for a custom data type not using the @className decorator\n   */\n\n  Tools.GetClassName = function (object, isType) {\n    if (isType === void 0) {\n      isType = false;\n    }\n\n    var name = null;\n\n    if (!isType && object.getClassName) {\n      name = object.getClassName();\n    } else {\n      if (object instanceof Object) {\n        var classObj = isType ? object : Object.getPrototypeOf(object);\n        name = classObj.constructor[\"__bjsclassName__\"];\n      }\n\n      if (!name) {\n        name = _typeof(object);\n      }\n    }\n\n    return name;\n  };\n  /**\n   * Gets the first element of an array satisfying a given predicate\n   * @param array defines the array to browse\n   * @param predicate defines the predicate to use\n   * @returns null if not found or the element\n   */\n\n\n  Tools.First = function (array, predicate) {\n    for (var _i = 0, array_1 = array; _i < array_1.length; _i++) {\n      var el = array_1[_i];\n\n      if (predicate(el)) {\n        return el;\n      }\n    }\n\n    return null;\n  };\n  /**\n   * This method will return the name of the full name of the class, including its owning module (if any).\n   * It will works only on Javascript basic data types (number, string, ...) and instance of class declared with the @className decorator or implementing a method getClassName():string (in which case the module won't be specified).\n   * @param object the object to get the class name from\n   * @param isType defines if the object is actually a type\n   * @return a string that can have two forms: \"moduleName.className\" if module was specified when the class' Name was registered or \"className\" if there was not module specified.\n   * @ignorenaming\n   */\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n\n\n  Tools.getFullClassName = function (object, isType) {\n    if (isType === void 0) {\n      isType = false;\n    }\n\n    var className = null;\n    var moduleName = null;\n\n    if (!isType && object.getClassName) {\n      className = object.getClassName();\n    } else {\n      if (object instanceof Object) {\n        var classObj = isType ? object : Object.getPrototypeOf(object);\n        className = classObj.constructor[\"__bjsclassName__\"];\n        moduleName = classObj.constructor[\"__bjsmoduleName__\"];\n      }\n\n      if (!className) {\n        className = _typeof(object);\n      }\n    }\n\n    if (!className) {\n      return null;\n    }\n\n    return (moduleName != null ? moduleName + \".\" : \"\") + className;\n  };\n  /**\n   * Returns a promise that resolves after the given amount of time.\n   * @param delay Number of milliseconds to delay\n   * @returns Promise that resolves after the given amount of time\n   */\n\n\n  Tools.DelayAsync = function (delay) {\n    return new Promise(function (resolve) {\n      setTimeout(function () {\n        resolve();\n      }, delay);\n    });\n  };\n  /**\n   * Utility function to detect if the current user agent is Safari\n   * @returns whether or not the current user agent is safari\n   */\n\n\n  Tools.IsSafari = function () {\n    if (!IsNavigatorAvailable()) {\n      return false;\n    }\n\n    return /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n  };\n  /**\n   * Enable/Disable Custom HTTP Request Headers globally.\n   * default = false\n   * @see CustomRequestHeaders\n   */\n\n\n  Tools.UseCustomRequestHeaders = false;\n  /**\n   * Custom HTTP Request Headers to be sent with XMLHttpRequests\n   * i.e. when loading files, where the server/service expects an Authorization header\n   */\n\n  Tools.CustomRequestHeaders = WebRequest.CustomRequestHeaders;\n  Tools._TmpFloatArray = new Float32Array(1);\n  /**\n   * Extracts text content from a DOM element hierarchy\n   * Back Compat only, please use GetDOMTextContent instead.\n   */\n\n  Tools.GetDOMTextContent = GetDOMTextContent;\n  Tools.GetAbsoluteUrl = (typeof document === \"undefined\" ? \"undefined\" : _typeof(document)) === \"object\" ? function (url) {\n    var a = document.createElement(\"a\");\n    a.href = url;\n    return a.href;\n  } : typeof URL === \"function\" && (typeof location === \"undefined\" ? \"undefined\" : _typeof(location)) === \"object\" ? function (url) {\n    return new URL(url, location.origin).href;\n  } : function () {\n    throw new Error(\"Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.\");\n  }; // Logs\n\n  /**\n   * No log\n   */\n\n  Tools.NoneLogLevel = Logger.NoneLogLevel;\n  /**\n   * Only message logs\n   */\n\n  Tools.MessageLogLevel = Logger.MessageLogLevel;\n  /**\n   * Only warning logs\n   */\n\n  Tools.WarningLogLevel = Logger.WarningLogLevel;\n  /**\n   * Only error logs\n   */\n\n  Tools.ErrorLogLevel = Logger.ErrorLogLevel;\n  /**\n   * All logs\n   */\n\n  Tools.AllLogLevel = Logger.AllLogLevel;\n  /**\n   * Checks if the window object exists\n   * Back Compat only, please use IsWindowObjectExist instead.\n   */\n\n  Tools.IsWindowObjectExist = IsWindowObjectExist; // Performances\n\n  /**\n   * No performance log\n   */\n\n  Tools.PerformanceNoneLogLevel = 0;\n  /**\n   * Use user marks to log performance\n   */\n\n  Tools.PerformanceUserMarkLogLevel = 1;\n  /**\n   * Log performance to the console\n   */\n\n  Tools.PerformanceConsoleLogLevel = 2;\n  /**\n   * Starts a performance counter\n   */\n\n  Tools.StartPerformanceCounter = Tools._StartPerformanceCounterDisabled;\n  /**\n   * Ends a specific performance counter\n   */\n\n  Tools.EndPerformanceCounter = Tools._EndPerformanceCounterDisabled;\n  return Tools;\n}();\n\nexport { Tools };\n/**\n * Use this className as a decorator on a given class definition to add it a name and optionally its module.\n * You can then use the Tools.getClassName(obj) on an instance to retrieve its class name.\n * This method is the only way to get it done in all cases, even if the .js file declaring the class is minified\n * @param name The name of the class, case should be preserved\n * @param module The name of the Module hosting the class, optional, but strongly recommended to specify if possible. Case should be preserved.\n */\n\nexport function className(name, module) {\n  return function (target) {\n    target[\"__bjsclassName__\"] = name;\n    target[\"__bjsmoduleName__\"] = module != null ? module : null;\n  };\n}\n/**\n * An implementation of a loop for asynchronous functions.\n */\n\nvar AsyncLoop =\n/** @class */\nfunction () {\n  /**\n   * Constructor.\n   * @param iterations the number of iterations.\n   * @param func the function to run each iteration\n   * @param successCallback the callback that will be called upon successful execution\n   * @param offset starting offset.\n   */\n  function AsyncLoop(\n  /**\n   * Defines the number of iterations for the loop\n   */\n  iterations, func, successCallback, offset) {\n    if (offset === void 0) {\n      offset = 0;\n    }\n\n    this.iterations = iterations;\n    this.index = offset - 1;\n    this._done = false;\n    this._fn = func;\n    this._successCallback = successCallback;\n  }\n  /**\n   * Execute the next iteration. Must be called after the last iteration was finished.\n   */\n\n\n  AsyncLoop.prototype.executeNext = function () {\n    if (!this._done) {\n      if (this.index + 1 < this.iterations) {\n        ++this.index;\n\n        this._fn(this);\n      } else {\n        this.breakLoop();\n      }\n    }\n  };\n  /**\n   * Break the loop and run the success callback.\n   */\n\n\n  AsyncLoop.prototype.breakLoop = function () {\n    this._done = true;\n\n    this._successCallback();\n  };\n  /**\n   * Create and run an async loop.\n   * @param iterations the number of iterations.\n   * @param fn the function to run each iteration\n   * @param successCallback the callback that will be called upon successful execution\n   * @param offset starting offset.\n   * @returns the created async loop object\n   */\n\n\n  AsyncLoop.Run = function (iterations, fn, successCallback, offset) {\n    if (offset === void 0) {\n      offset = 0;\n    }\n\n    var loop = new AsyncLoop(iterations, fn, successCallback, offset);\n    loop.executeNext();\n    return loop;\n  };\n  /**\n   * A for-loop that will run a given number of iterations synchronous and the rest async.\n   * @param iterations total number of iterations\n   * @param syncedIterations number of synchronous iterations in each async iteration.\n   * @param fn the function to call each iteration.\n   * @param callback a success call back that will be called when iterating stops.\n   * @param breakFunction a break condition (optional)\n   * @param timeout timeout settings for the setTimeout function. default - 0.\n   * @returns the created async loop object\n   */\n\n\n  AsyncLoop.SyncAsyncForLoop = function (iterations, syncedIterations, fn, callback, breakFunction, timeout) {\n    if (timeout === void 0) {\n      timeout = 0;\n    }\n\n    return AsyncLoop.Run(Math.ceil(iterations / syncedIterations), function (loop) {\n      if (breakFunction && breakFunction()) {\n        loop.breakLoop();\n      } else {\n        setTimeout(function () {\n          for (var i = 0; i < syncedIterations; ++i) {\n            var iteration = loop.index * syncedIterations + i;\n\n            if (iteration >= iterations) {\n              break;\n            }\n\n            fn(iteration);\n\n            if (breakFunction && breakFunction()) {\n              loop.breakLoop();\n              break;\n            }\n          }\n\n          loop.executeNext();\n        }, timeout);\n      }\n    }, callback);\n  };\n\n  return AsyncLoop;\n}();\n\nexport { AsyncLoop }; // Will only be define if Tools is imported freeing up some space when only engine is required\n\nEngineStore.FallbackTexture = \"data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z\"; // Register promise fallback for IE\n\nPromisePolyfill.Apply();","map":{"version":3,"mappings":"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","names":["Observable","GetDOMTextContent","IsNavigatorAvailable","IsWindowObjectExist","Logger","DeepCopier","PrecisionDate","_WarnImport","WebRequest","EngineStore","FileToolsOptions","DecodeBase64UrlToBinary","IsBase64DataUrl","LoadFile","FileToolsLoadFile","LoadImage","FileToolLoadImage","ReadFile","FileToolsReadFile","SetCorsBehavior","PromisePolyfill","TimingTools","InstantiationTools","RandomGUID","SliceTools","Object","Tools","BaseUrl","value","DefaultRetryStrategy","strategy","CorsBehavior","UseFallbackTexture","RegisteredExternalClasses","classes","FallbackTexture","u","v","width","height","pixels","color","wrappedU","Math","abs","wrappedV","position","r","g","b","a","alpha","className","Instantiate","data","start","end","Slice","SliceToArray","action","SetImmediate","count","fround","_TmpFloatArray","path","index","lastIndexOf","substring","uri","returnUnchangedIfNoSlash","angle","PI","obj","allowsNullUndefined","undefined","Array","isArray","engine","eventPrefix","window","PointerEvent","_badDesktopOS","_badOS","document","url","element","replace","PreprocessUrl","processor","input","onLoad","onError","offlineProvider","mimeType","imageBitmapOptions","onSuccess","onProgress","useArrayBuffer","Promise","resolve","reject","request","exception","scriptUrl","scriptId","head","getElementsByTagName","script","createElement","setAttribute","id","onload","onerror","e","appendChild","_this","LoadScript","message","fileToLoad","callback","progressCallback","reader","FileReader","onCompleteObservable","abort","onloadend","notifyObservers","target","onprogress","readAsDataURL","file","content","fileBlob","Blob","URL","webkitURL","link","createObjectURL","decimals","toFixed","source","destination","doNotCopyList","mustCopyList","DeepCopy","i","prototype","hasOwnProperty","call","windowElement","events","length","event_1","addEventListener","name","handler","parent","event_2","removeEventListener","successCallback","fileName","readPixels","bufferView","_a","Uint8Array","buffer","DumpData","invertY","toArrayBuffer","quality","_ScreenshotCanvas","context","getContext","Float32Array","data2","n","round","imageData","createImageData","castData","set","putImageData","canvas","canvas2","ctx2","translate","scale","drawImage","ToBlob","blob","fileReader","event","arrayBuffer","result","readAsArrayBuffer","EncodeScreenshotCanvasData","toBlob","type","setTimeout","binStr","atob","toDataURL","split","len","arr","charCodeAt","base64Image","date","Date","stringDate","getFullYear","getMonth","slice","getDate","getHours","getMinutes","Download","url_1","newWindow","open","img","revokeObjectURL","src","body","navigator","msSaveBlob","style","display","href","download","parentElement","removeChild","click","args","camera","size","samples","antialiasing","errorsCount","Log","Warn","Error","LogCache","ClearLogCache","level","LogLevels","PerformanceUserMarkLogLevel","StartPerformanceCounter","_StartUserMark","EndPerformanceCounter","_EndUserMark","PerformanceConsoleLogLevel","_StartPerformanceConsole","_EndPerformanceConsole","_StartPerformanceCounterDisabled","_EndPerformanceCounterDisabled","counterName","condition","_Performance","performance","mark","measure","console","time","timeEnd","Now","object","isType","getClassName","classObj","getPrototypeOf","constructor","array","predicate","_i","el","moduleName","delay","test","userAgent","CustomRequestHeaders","location","origin","NoneLogLevel","MessageLogLevel","WarningLogLevel","ErrorLogLevel","AllLogLevel","module","iterations","func","offset","_done","_fn","_successCallback","AsyncLoop","breakLoop","fn","loop","executeNext","syncedIterations","breakFunction","timeout","Run","ceil","iteration","Apply"],"sourceRoot":"","sources":["../../../../../lts/core/generated/Misc/tools.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\nimport type { Nullable, float } from \"../types\";\r\nimport { Observable } from \"./observable\";\r\nimport { GetDOMTextContent, IsNavigatorAvailable, IsWindowObjectExist } from \"./domManagement\";\r\nimport { Logger } from \"./logger\";\r\nimport { DeepCopier } from \"./deepCopier\";\r\nimport { PrecisionDate } from \"./precisionDate\";\r\nimport { _WarnImport } from \"./devTools\";\r\nimport { WebRequest } from \"./webRequest\";\r\nimport type { IFileRequest } from \"./fileRequest\";\r\nimport { EngineStore } from \"../Engines/engineStore\";\r\nimport type { ReadFileError } from \"./fileTools\";\r\nimport {\r\n    FileToolsOptions,\r\n    DecodeBase64UrlToBinary,\r\n    IsBase64DataUrl,\r\n    LoadFile as FileToolsLoadFile,\r\n    LoadImage as FileToolLoadImage,\r\n    ReadFile as FileToolsReadFile,\r\n    SetCorsBehavior,\r\n} from \"./fileTools\";\r\nimport type { IOfflineProvider } from \"../Offline/IOfflineProvider\";\r\nimport { PromisePolyfill } from \"./promise\";\r\nimport { TimingTools } from \"./timingTools\";\r\nimport { InstantiationTools } from \"./instantiationTools\";\r\nimport { RandomGUID } from \"./guid\";\r\nimport type { IScreenshotSize } from \"./interfaces/screenshotSize\";\r\nimport { SliceTools } from \"./sliceTools\";\r\n\r\ndeclare type Camera = import(\"../Cameras/camera\").Camera;\r\ndeclare type Engine = import(\"../Engines/engine\").Engine;\r\n\r\ninterface IColor4Like {\r\n    r: float;\r\n    g: float;\r\n    b: float;\r\n    a: float;\r\n}\r\n\r\n/**\r\n * Class containing a set of static utilities functions\r\n */\r\nexport class Tools {\r\n    /**\r\n     * Gets or sets the base URL to use to load assets\r\n     */\r\n    public static get BaseUrl() {\r\n        return FileToolsOptions.BaseUrl;\r\n    }\r\n\r\n    public static set BaseUrl(value: string) {\r\n        FileToolsOptions.BaseUrl = value;\r\n    }\r\n\r\n    /**\r\n     * Enable/Disable Custom HTTP Request Headers globally.\r\n     * default = false\r\n     * @see CustomRequestHeaders\r\n     */\r\n    public static UseCustomRequestHeaders: boolean = false;\r\n\r\n    /**\r\n     * Custom HTTP Request Headers to be sent with XMLHttpRequests\r\n     * i.e. when loading files, where the server/service expects an Authorization header\r\n     */\r\n    public static CustomRequestHeaders = WebRequest.CustomRequestHeaders;\r\n\r\n    /**\r\n     * Gets or sets the retry strategy to apply when an error happens while loading an asset\r\n     */\r\n    public static get DefaultRetryStrategy() {\r\n        return FileToolsOptions.DefaultRetryStrategy;\r\n    }\r\n\r\n    public static set DefaultRetryStrategy(strategy: (url: string, request: WebRequest, retryIndex: number) => number) {\r\n        FileToolsOptions.DefaultRetryStrategy = strategy;\r\n    }\r\n\r\n    /**\r\n     * Default behaviour for cors in the application.\r\n     * It can be a string if the expected behavior is identical in the entire app.\r\n     * Or a callback to be able to set it per url or on a group of them (in case of Video source for instance)\r\n     */\r\n    public static get CorsBehavior(): string | ((url: string | string[]) => string) {\r\n        return FileToolsOptions.CorsBehavior;\r\n    }\r\n\r\n    public static set CorsBehavior(value: string | ((url: string | string[]) => string)) {\r\n        FileToolsOptions.CorsBehavior = value;\r\n    }\r\n\r\n    /**\r\n     * Gets or sets a global variable indicating if fallback texture must be used when a texture cannot be loaded\r\n     * @ignorenaming\r\n     */\r\n    public static get UseFallbackTexture() {\r\n        return EngineStore.UseFallbackTexture;\r\n    }\r\n\r\n    public static set UseFallbackTexture(value: boolean) {\r\n        EngineStore.UseFallbackTexture = value;\r\n    }\r\n\r\n    /**\r\n     * Use this object to register external classes like custom textures or material\r\n     * to allow the loaders to instantiate them\r\n     */\r\n    public static get RegisteredExternalClasses() {\r\n        return InstantiationTools.RegisteredExternalClasses;\r\n    }\r\n\r\n    public static set RegisteredExternalClasses(classes: { [key: string]: Object }) {\r\n        InstantiationTools.RegisteredExternalClasses = classes;\r\n    }\r\n\r\n    /**\r\n     * Texture content used if a texture cannot loaded\r\n     * @ignorenaming\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    public static get fallbackTexture() {\r\n        return EngineStore.FallbackTexture;\r\n    }\r\n\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    public static set fallbackTexture(value: string) {\r\n        EngineStore.FallbackTexture = value;\r\n    }\r\n\r\n    /**\r\n     * Read the content of a byte array at a specified coordinates (taking in account wrapping)\r\n     * @param u defines the coordinate on X axis\r\n     * @param v defines the coordinate on Y axis\r\n     * @param width defines the width of the source data\r\n     * @param height defines the height of the source data\r\n     * @param pixels defines the source byte array\r\n     * @param color defines the output color\r\n     */\r\n    public static FetchToRef(u: number, v: number, width: number, height: number, pixels: Uint8Array, color: IColor4Like): void {\r\n        const wrappedU = (Math.abs(u) * width) % width | 0;\r\n        const wrappedV = (Math.abs(v) * height) % height | 0;\r\n\r\n        const position = (wrappedU + wrappedV * width) * 4;\r\n        color.r = pixels[position] / 255;\r\n        color.g = pixels[position + 1] / 255;\r\n        color.b = pixels[position + 2] / 255;\r\n        color.a = pixels[position + 3] / 255;\r\n    }\r\n\r\n    /**\r\n     * Interpolates between a and b via alpha\r\n     * @param a The lower value (returned when alpha = 0)\r\n     * @param b The upper value (returned when alpha = 1)\r\n     * @param alpha The interpolation-factor\r\n     * @return The mixed value\r\n     */\r\n    public static Mix(a: number, b: number, alpha: number): number {\r\n        return a * (1 - alpha) + b * alpha;\r\n    }\r\n\r\n    /**\r\n     * Tries to instantiate a new object from a given class name\r\n     * @param className defines the class name to instantiate\r\n     * @returns the new object or null if the system was not able to do the instantiation\r\n     */\r\n    public static Instantiate(className: string): any {\r\n        return InstantiationTools.Instantiate(className);\r\n    }\r\n\r\n    /**\r\n     * Provides a slice function that will work even on IE\r\n     * @param data defines the array to slice\r\n     * @param start defines the start of the data (optional)\r\n     * @param end defines the end of the data (optional)\r\n     * @returns the new sliced array\r\n     */\r\n    public static Slice<T>(data: T, start?: number, end?: number): T {\r\n        return SliceTools.Slice(data, start, end);\r\n    }\r\n\r\n    /**\r\n     * Provides a slice function that will work even on IE\r\n     * The difference between this and Slice is that this will force-convert to array\r\n     * @param data defines the array to slice\r\n     * @param start defines the start of the data (optional)\r\n     * @param end defines the end of the data (optional)\r\n     * @returns the new sliced array\r\n     */\r\n    public static SliceToArray<T, P>(data: T, start?: number, end?: number): Array<P> {\r\n        return SliceTools.SliceToArray(data, start, end);\r\n    }\r\n\r\n    /**\r\n     * Polyfill for setImmediate\r\n     * @param action defines the action to execute after the current execution block\r\n     */\r\n    public static SetImmediate(action: () => void) {\r\n        TimingTools.SetImmediate(action);\r\n    }\r\n\r\n    /**\r\n     * Function indicating if a number is an exponent of 2\r\n     * @param value defines the value to test\r\n     * @returns true if the value is an exponent of 2\r\n     */\r\n    public static IsExponentOfTwo(value: number): boolean {\r\n        let count = 1;\r\n\r\n        do {\r\n            count *= 2;\r\n        } while (count < value);\r\n\r\n        return count === value;\r\n    }\r\n\r\n    private static _TmpFloatArray = new Float32Array(1);\r\n\r\n    /**\r\n     * Returns the nearest 32-bit single precision float representation of a Number\r\n     * @param value A Number.  If the parameter is of a different type, it will get converted\r\n     * to a number or to NaN if it cannot be converted\r\n     * @returns number\r\n     */\r\n    public static FloatRound(value: number): number {\r\n        if (Math.fround) {\r\n            return Math.fround(value);\r\n        }\r\n\r\n        return (Tools._TmpFloatArray[0] = value), Tools._TmpFloatArray[0];\r\n    }\r\n\r\n    /**\r\n     * Extracts the filename from a path\r\n     * @param path defines the path to use\r\n     * @returns the filename\r\n     */\r\n    public static GetFilename(path: string): string {\r\n        const index = path.lastIndexOf(\"/\");\r\n        if (index < 0) {\r\n            return path;\r\n        }\r\n\r\n        return path.substring(index + 1);\r\n    }\r\n\r\n    /**\r\n     * Extracts the \"folder\" part of a path (everything before the filename).\r\n     * @param uri The URI to extract the info from\r\n     * @param returnUnchangedIfNoSlash Do not touch the URI if no slashes are present\r\n     * @returns The \"folder\" part of the path\r\n     */\r\n    public static GetFolderPath(uri: string, returnUnchangedIfNoSlash = false): string {\r\n        const index = uri.lastIndexOf(\"/\");\r\n        if (index < 0) {\r\n            if (returnUnchangedIfNoSlash) {\r\n                return uri;\r\n            }\r\n            return \"\";\r\n        }\r\n\r\n        return uri.substring(0, index + 1);\r\n    }\r\n\r\n    /**\r\n     * Extracts text content from a DOM element hierarchy\r\n     * Back Compat only, please use GetDOMTextContent instead.\r\n     */\r\n    public static GetDOMTextContent = GetDOMTextContent;\r\n\r\n    /**\r\n     * Convert an angle in radians to degrees\r\n     * @param angle defines the angle to convert\r\n     * @returns the angle in degrees\r\n     */\r\n    public static ToDegrees(angle: number): number {\r\n        return (angle * 180) / Math.PI;\r\n    }\r\n\r\n    /**\r\n     * Convert an angle in degrees to radians\r\n     * @param angle defines the angle to convert\r\n     * @returns the angle in radians\r\n     */\r\n    public static ToRadians(angle: number): number {\r\n        return (angle * Math.PI) / 180;\r\n    }\r\n\r\n    /**\r\n     * Returns an array if obj is not an array\r\n     * @param obj defines the object to evaluate as an array\r\n     * @param allowsNullUndefined defines a boolean indicating if obj is allowed to be null or undefined\r\n     * @returns either obj directly if obj is an array or a new array containing obj\r\n     */\r\n    public static MakeArray(obj: any, allowsNullUndefined?: boolean): Nullable<Array<any>> {\r\n        if (allowsNullUndefined !== true && (obj === undefined || obj == null)) {\r\n            return null;\r\n        }\r\n\r\n        return Array.isArray(obj) ? obj : [obj];\r\n    }\r\n\r\n    /**\r\n     * Gets the pointer prefix to use\r\n     * @param engine defines the engine we are finding the prefix for\r\n     * @returns \"pointer\" if touch is enabled. Else returns \"mouse\"\r\n     */\r\n    public static GetPointerPrefix(engine: Engine): string {\r\n        let eventPrefix = \"pointer\";\r\n\r\n        // Check if pointer events are supported\r\n        if (IsWindowObjectExist() && !window.PointerEvent) {\r\n            eventPrefix = \"mouse\";\r\n        }\r\n\r\n        // Special Fallback MacOS Safari...\r\n        if (\r\n            engine._badDesktopOS &&\r\n            !engine._badOS &&\r\n            // And not ipad pros who claim to be macs...\r\n            !(document && \"ontouchend\" in document)\r\n        ) {\r\n            eventPrefix = \"mouse\";\r\n        }\r\n\r\n        return eventPrefix;\r\n    }\r\n\r\n    /**\r\n     * Sets the cors behavior on a dom element. This will add the required Tools.CorsBehavior to the element.\r\n     * @param url define the url we are trying\r\n     * @param element define the dom element where to configure the cors policy\r\n     * @param element.crossOrigin\r\n     */\r\n    public static SetCorsBehavior(url: string | string[], element: { crossOrigin: string | null }): void {\r\n        SetCorsBehavior(url, element);\r\n    }\r\n\r\n    // External files\r\n\r\n    /**\r\n     * Removes unwanted characters from an url\r\n     * @param url defines the url to clean\r\n     * @returns the cleaned url\r\n     */\r\n    public static CleanUrl(url: string): string {\r\n        url = url.replace(/#/gm, \"%23\");\r\n        return url;\r\n    }\r\n\r\n    /**\r\n     * Gets or sets a function used to pre-process url before using them to load assets\r\n     */\r\n    public static get PreprocessUrl() {\r\n        return FileToolsOptions.PreprocessUrl;\r\n    }\r\n\r\n    public static set PreprocessUrl(processor: (url: string) => string) {\r\n        FileToolsOptions.PreprocessUrl = processor;\r\n    }\r\n\r\n    /**\r\n     * Loads an image as an HTMLImageElement.\r\n     * @param input url string, ArrayBuffer, or Blob to load\r\n     * @param onLoad callback called when the image successfully loads\r\n     * @param onError callback called when the image fails to load\r\n     * @param offlineProvider offline provider for caching\r\n     * @param mimeType optional mime type\r\n     * @param imageBitmapOptions optional the options to use when creating an ImageBitmap\r\n     * @returns the HTMLImageElement of the loaded image\r\n     */\r\n    public static LoadImage(\r\n        input: string | ArrayBuffer | Blob,\r\n        onLoad: (img: HTMLImageElement | ImageBitmap) => void,\r\n        onError: (message?: string, exception?: any) => void,\r\n        offlineProvider: Nullable<IOfflineProvider>,\r\n        mimeType?: string,\r\n        imageBitmapOptions?: ImageBitmapOptions\r\n    ): Nullable<HTMLImageElement> {\r\n        return FileToolLoadImage(input, onLoad, onError, offlineProvider, mimeType, imageBitmapOptions);\r\n    }\r\n\r\n    /**\r\n     * Loads a file from a url\r\n     * @param url url string, ArrayBuffer, or Blob to load\r\n     * @param onSuccess callback called when the file successfully loads\r\n     * @param onProgress callback called while file is loading (if the server supports this mode)\r\n     * @param offlineProvider defines the offline provider for caching\r\n     * @param useArrayBuffer defines a boolean indicating that date must be returned as ArrayBuffer\r\n     * @param onError callback called when the file fails to load\r\n     * @returns a file request object\r\n     */\r\n    public static LoadFile(\r\n        url: string,\r\n        onSuccess: (data: string | ArrayBuffer, responseURL?: string) => void,\r\n        onProgress?: (data: any) => void,\r\n        offlineProvider?: IOfflineProvider,\r\n        useArrayBuffer?: boolean,\r\n        onError?: (request?: WebRequest, exception?: any) => void\r\n    ): IFileRequest {\r\n        return FileToolsLoadFile(url, onSuccess, onProgress, offlineProvider, useArrayBuffer, onError);\r\n    }\r\n\r\n    /**\r\n     * Loads a file from a url\r\n     * @param url the file url to load\r\n     * @param useArrayBuffer defines a boolean indicating that date must be returned as ArrayBuffer\r\n     * @returns a promise containing an ArrayBuffer corresponding to the loaded file\r\n     */\r\n    public static LoadFileAsync(url: string, useArrayBuffer: boolean = true): Promise<ArrayBuffer | string> {\r\n        return new Promise((resolve, reject) => {\r\n            FileToolsLoadFile(\r\n                url,\r\n                (data) => {\r\n                    resolve(data);\r\n                },\r\n                undefined,\r\n                undefined,\r\n                useArrayBuffer,\r\n                (request, exception) => {\r\n                    reject(exception);\r\n                }\r\n            );\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Load a script (identified by an url). When the url returns, the\r\n     * content of this file is added into a new script element, attached to the DOM (body element)\r\n     * @param scriptUrl defines the url of the script to laod\r\n     * @param onSuccess defines the callback called when the script is loaded\r\n     * @param onError defines the callback to call if an error occurs\r\n     * @param scriptId defines the id of the script element\r\n     */\r\n    public static LoadScript(scriptUrl: string, onSuccess: () => void, onError?: (message?: string, exception?: any) => void, scriptId?: string) {\r\n        if (!IsWindowObjectExist()) {\r\n            return;\r\n        }\r\n        const head = document.getElementsByTagName(\"head\")[0];\r\n        const script = document.createElement(\"script\");\r\n        script.setAttribute(\"type\", \"text/javascript\");\r\n        script.setAttribute(\"src\", scriptUrl);\r\n        if (scriptId) {\r\n            script.id = scriptId;\r\n        }\r\n\r\n        script.onload = () => {\r\n            if (onSuccess) {\r\n                onSuccess();\r\n            }\r\n        };\r\n\r\n        script.onerror = (e) => {\r\n            if (onError) {\r\n                onError(`Unable to load script '${scriptUrl}'`, e);\r\n            }\r\n        };\r\n\r\n        head.appendChild(script);\r\n    }\r\n\r\n    /**\r\n     * Load an asynchronous script (identified by an url). When the url returns, the\r\n     * content of this file is added into a new script element, attached to the DOM (body element)\r\n     * @param scriptUrl defines the url of the script to laod\r\n     * @returns a promise request object\r\n     */\r\n    public static LoadScriptAsync(scriptUrl: string): Promise<void> {\r\n        return new Promise((resolve, reject) => {\r\n            this.LoadScript(\r\n                scriptUrl,\r\n                () => {\r\n                    resolve();\r\n                },\r\n                (message, exception) => {\r\n                    reject(exception);\r\n                }\r\n            );\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Loads a file from a blob\r\n     * @param fileToLoad defines the blob to use\r\n     * @param callback defines the callback to call when data is loaded\r\n     * @param progressCallback defines the callback to call during loading process\r\n     * @returns a file request object\r\n     */\r\n    public static ReadFileAsDataURL(fileToLoad: Blob, callback: (data: any) => void, progressCallback: (ev: ProgressEvent) => any): IFileRequest {\r\n        const reader = new FileReader();\r\n\r\n        const request: IFileRequest = {\r\n            onCompleteObservable: new Observable<IFileRequest>(),\r\n            abort: () => reader.abort(),\r\n        };\r\n\r\n        reader.onloadend = () => {\r\n            request.onCompleteObservable.notifyObservers(request);\r\n        };\r\n\r\n        reader.onload = (e) => {\r\n            //target doesn't have result from ts 1.3\r\n            callback((<any>e.target)[\"result\"]);\r\n        };\r\n\r\n        reader.onprogress = progressCallback;\r\n\r\n        reader.readAsDataURL(fileToLoad);\r\n\r\n        return request;\r\n    }\r\n\r\n    /**\r\n     * Reads a file from a File object\r\n     * @param file defines the file to load\r\n     * @param onSuccess defines the callback to call when data is loaded\r\n     * @param onProgress defines the callback to call during loading process\r\n     * @param useArrayBuffer defines a boolean indicating that data must be returned as an ArrayBuffer\r\n     * @param onError defines the callback to call when an error occurs\r\n     * @returns a file request object\r\n     */\r\n    public static ReadFile(\r\n        file: File,\r\n        onSuccess: (data: any) => void,\r\n        onProgress?: (ev: ProgressEvent) => any,\r\n        useArrayBuffer?: boolean,\r\n        onError?: (error: ReadFileError) => void\r\n    ): IFileRequest {\r\n        return FileToolsReadFile(file, onSuccess, onProgress, useArrayBuffer, onError);\r\n    }\r\n\r\n    /**\r\n     * Creates a data url from a given string content\r\n     * @param content defines the content to convert\r\n     * @returns the new data url link\r\n     */\r\n    public static FileAsURL(content: string): string {\r\n        const fileBlob = new Blob([content]);\r\n        const url = window.URL || window.webkitURL;\r\n        const link: string = url.createObjectURL(fileBlob);\r\n        return link;\r\n    }\r\n\r\n    /**\r\n     * Format the given number to a specific decimal format\r\n     * @param value defines the number to format\r\n     * @param decimals defines the number of decimals to use\r\n     * @returns the formatted string\r\n     */\r\n    public static Format(value: number, decimals: number = 2): string {\r\n        return value.toFixed(decimals);\r\n    }\r\n\r\n    /**\r\n     * Tries to copy an object by duplicating every property\r\n     * @param source defines the source object\r\n     * @param destination defines the target object\r\n     * @param doNotCopyList defines a list of properties to avoid\r\n     * @param mustCopyList defines a list of properties to copy (even if they start with _)\r\n     */\r\n    public static DeepCopy(source: any, destination: any, doNotCopyList?: string[], mustCopyList?: string[]): void {\r\n        DeepCopier.DeepCopy(source, destination, doNotCopyList, mustCopyList);\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if the given object has no own property\r\n     * @param obj defines the object to test\r\n     * @returns true if object has no own property\r\n     */\r\n    public static IsEmpty(obj: any): boolean {\r\n        for (const i in obj) {\r\n            if (Object.prototype.hasOwnProperty.call(obj, i)) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Function used to register events at window level\r\n     * @param windowElement defines the Window object to use\r\n     * @param events defines the events to register\r\n     */\r\n    public static RegisterTopRootEvents(windowElement: Window, events: { name: string; handler: Nullable<(e: FocusEvent) => any> }[]): void {\r\n        for (let index = 0; index < events.length; index++) {\r\n            const event = events[index];\r\n            windowElement.addEventListener(event.name, <any>event.handler, false);\r\n\r\n            try {\r\n                if (window.parent) {\r\n                    window.parent.addEventListener(event.name, <any>event.handler, false);\r\n                }\r\n            } catch (e) {\r\n                // Silently fails...\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Function used to unregister events from window level\r\n     * @param windowElement defines the Window object to use\r\n     * @param events defines the events to unregister\r\n     */\r\n    public static UnregisterTopRootEvents(windowElement: Window, events: { name: string; handler: Nullable<(e: FocusEvent) => any> }[]): void {\r\n        for (let index = 0; index < events.length; index++) {\r\n            const event = events[index];\r\n            windowElement.removeEventListener(event.name, <any>event.handler);\r\n\r\n            try {\r\n                if (windowElement.parent) {\r\n                    windowElement.parent.removeEventListener(event.name, <any>event.handler);\r\n                }\r\n            } catch (e) {\r\n                // Silently fails...\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @ignore\r\n     */\r\n    public static _ScreenshotCanvas: HTMLCanvasElement;\r\n\r\n    /**\r\n     * Dumps the current bound framebuffer\r\n     * @param width defines the rendering width\r\n     * @param height defines the rendering height\r\n     * @param engine defines the hosting engine\r\n     * @param successCallback defines the callback triggered once the data are available\r\n     * @param mimeType defines the mime type of the result\r\n     * @param fileName defines the filename to download. If present, the result will automatically be downloaded\r\n     * @return a void promise\r\n     */\r\n    public static async DumpFramebuffer(\r\n        width: number,\r\n        height: number,\r\n        engine: Engine,\r\n        successCallback?: (data: string) => void,\r\n        mimeType: string = \"image/png\",\r\n        fileName?: string\r\n    ) {\r\n        // Read the contents of the framebuffer\r\n        const bufferView = await engine.readPixels(0, 0, width, height);\r\n\r\n        const data = new Uint8Array(bufferView.buffer);\r\n\r\n        Tools.DumpData(width, height, data, successCallback as (data: string | ArrayBuffer) => void, mimeType, fileName, true);\r\n    }\r\n\r\n    /**\r\n     * Dumps an array buffer\r\n     * @param width defines the rendering width\r\n     * @param height defines the rendering height\r\n     * @param data the data array\r\n     * @param successCallback defines the callback triggered once the data are available\r\n     * @param mimeType defines the mime type of the result\r\n     * @param fileName defines the filename to download. If present, the result will automatically be downloaded\r\n     * @param invertY true to invert the picture in the Y dimension\r\n     * @param toArrayBuffer true to convert the data to an ArrayBuffer (encoded as `mimeType`) instead of a base64 string\r\n     * @param quality defines the quality of the result\r\n     */\r\n    public static DumpData(\r\n        width: number,\r\n        height: number,\r\n        data: ArrayBufferView,\r\n        successCallback?: (data: string | ArrayBuffer) => void,\r\n        mimeType: string = \"image/png\",\r\n        fileName?: string,\r\n        invertY = false,\r\n        toArrayBuffer = false,\r\n        quality?: number\r\n    ) {\r\n        // Create a 2D canvas to store the result\r\n        if (!Tools._ScreenshotCanvas) {\r\n            Tools._ScreenshotCanvas = document.createElement(\"canvas\");\r\n        }\r\n        Tools._ScreenshotCanvas.width = width;\r\n        Tools._ScreenshotCanvas.height = height;\r\n        const context = Tools._ScreenshotCanvas.getContext(\"2d\");\r\n\r\n        if (context) {\r\n            // Convert if data are float32\r\n            if (data instanceof Float32Array) {\r\n                const data2 = new Uint8Array(data.length);\r\n                let n = data.length;\r\n                while (n--) {\r\n                    const v = data[n];\r\n                    data2[n] = v < 0 ? 0 : v > 1 ? 1 : Math.round(v * 255);\r\n                }\r\n                data = data2;\r\n            }\r\n\r\n            // Copy the pixels to a 2D canvas\r\n            const imageData = context.createImageData(width, height);\r\n            const castData = <any>imageData.data;\r\n            castData.set(data);\r\n            context.putImageData(imageData, 0, 0);\r\n\r\n            let canvas = Tools._ScreenshotCanvas;\r\n\r\n            if (invertY) {\r\n                const canvas2 = document.createElement(\"canvas\");\r\n                canvas2.width = width;\r\n                canvas2.height = height;\r\n\r\n                const ctx2 = canvas2.getContext(\"2d\");\r\n                if (!ctx2) {\r\n                    return;\r\n                }\r\n\r\n                ctx2.translate(0, height);\r\n                ctx2.scale(1, -1);\r\n                ctx2.drawImage(Tools._ScreenshotCanvas, 0, 0);\r\n\r\n                canvas = canvas2;\r\n            }\r\n\r\n            if (toArrayBuffer) {\r\n                Tools.ToBlob(\r\n                    canvas,\r\n                    (blob) => {\r\n                        const fileReader = new FileReader();\r\n                        fileReader.onload = (event: any) => {\r\n                            const arrayBuffer = event.target!.result as ArrayBuffer;\r\n                            if (successCallback) {\r\n                                successCallback(arrayBuffer);\r\n                            }\r\n                        };\r\n                        fileReader.readAsArrayBuffer(blob!);\r\n                    },\r\n                    mimeType,\r\n                    quality\r\n                );\r\n            } else {\r\n                Tools.EncodeScreenshotCanvasData(successCallback, mimeType, fileName, canvas, quality);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Dumps an array buffer\r\n     * @param width defines the rendering width\r\n     * @param height defines the rendering height\r\n     * @param data the data array\r\n     * @param mimeType defines the mime type of the result\r\n     * @param fileName defines the filename to download. If present, the result will automatically be downloaded\r\n     * @param invertY true to invert the picture in the Y dimension\r\n     * @param toArrayBuffer true to convert the data to an ArrayBuffer (encoded as `mimeType`) instead of a base64 string\r\n     * @param quality defines the quality of the result\r\n     * @return a promise that resolve to the final data\r\n     */\r\n    public static DumpDataAsync(\r\n        width: number,\r\n        height: number,\r\n        data: ArrayBufferView,\r\n        mimeType: string = \"image/png\",\r\n        fileName?: string,\r\n        invertY = false,\r\n        toArrayBuffer = false,\r\n        quality?: number\r\n    ): Promise<string | ArrayBuffer> {\r\n        return new Promise((resolve) => {\r\n            Tools.DumpData(width, height, data, (result) => resolve(result), mimeType, fileName, invertY, toArrayBuffer, quality);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Converts the canvas data to blob.\r\n     * This acts as a polyfill for browsers not supporting the to blob function.\r\n     * @param canvas Defines the canvas to extract the data from\r\n     * @param successCallback Defines the callback triggered once the data are available\r\n     * @param mimeType Defines the mime type of the result\r\n     * @param quality defines the quality of the result\r\n     */\r\n    static ToBlob(canvas: HTMLCanvasElement, successCallback: (blob: Nullable<Blob>) => void, mimeType: string = \"image/png\", quality?: number): void {\r\n        // We need HTMLCanvasElement.toBlob for HD screenshots\r\n        if (!canvas.toBlob) {\r\n            //  low performance polyfill based on toDataURL (https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toBlob)\r\n            canvas.toBlob = function (callback, type, quality) {\r\n                setTimeout(() => {\r\n                    const binStr = atob(this.toDataURL(type, quality).split(\",\")[1]),\r\n                        len = binStr.length,\r\n                        arr = new Uint8Array(len);\r\n\r\n                    for (let i = 0; i < len; i++) {\r\n                        arr[i] = binStr.charCodeAt(i);\r\n                    }\r\n                    callback(new Blob([arr]));\r\n                });\r\n            };\r\n        }\r\n        canvas.toBlob(\r\n            function (blob) {\r\n                successCallback(blob);\r\n            },\r\n            mimeType,\r\n            quality\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Encodes the canvas data to base 64 or automatically download the result if filename is defined\r\n     * @param successCallback defines the callback triggered once the data are available\r\n     * @param mimeType defines the mime type of the result\r\n     * @param fileName defines he filename to download. If present, the result will automatically be downloaded\r\n     * @param canvas canvas to get the data from. If not provided, use the default screenshot canvas\r\n     * @param quality defines the quality of the result\r\n     */\r\n    static EncodeScreenshotCanvasData(\r\n        successCallback?: (data: string) => void,\r\n        mimeType: string = \"image/png\",\r\n        fileName?: string,\r\n        canvas?: HTMLCanvasElement,\r\n        quality?: number\r\n    ): void {\r\n        if (successCallback) {\r\n            const base64Image = (canvas ?? Tools._ScreenshotCanvas).toDataURL(mimeType, quality);\r\n            successCallback(base64Image);\r\n        } else {\r\n            this.ToBlob(\r\n                canvas ?? Tools._ScreenshotCanvas,\r\n                function (blob) {\r\n                    //Creating a link if the browser have the download attribute on the a tag, to automatically start download generated image.\r\n                    if (\"download\" in document.createElement(\"a\")) {\r\n                        if (!fileName) {\r\n                            const date = new Date();\r\n                            const stringDate =\r\n                                (date.getFullYear() + \"-\" + (date.getMonth() + 1)).slice(2) +\r\n                                \"-\" +\r\n                                date.getDate() +\r\n                                \"_\" +\r\n                                date.getHours() +\r\n                                \"-\" +\r\n                                (\"0\" + date.getMinutes()).slice(-2);\r\n                            fileName = \"screenshot_\" + stringDate + \".png\";\r\n                        }\r\n                        Tools.Download(blob!, fileName);\r\n                    } else {\r\n                        if (blob) {\r\n                            const url = URL.createObjectURL(blob);\r\n\r\n                            const newWindow = window.open(\"\");\r\n                            if (!newWindow) {\r\n                                return;\r\n                            }\r\n                            const img = newWindow.document.createElement(\"img\");\r\n                            img.onload = function () {\r\n                                // no longer need to read the blob so it's revoked\r\n                                URL.revokeObjectURL(url);\r\n                            };\r\n                            img.src = url;\r\n                            newWindow.document.body.appendChild(img);\r\n                        }\r\n                    }\r\n                },\r\n                mimeType,\r\n                quality\r\n            );\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Downloads a blob in the browser\r\n     * @param blob defines the blob to download\r\n     * @param fileName defines the name of the downloaded file\r\n     */\r\n    public static Download(blob: Blob, fileName: string): void {\r\n        if (navigator && (navigator as any).msSaveBlob) {\r\n            (navigator as any).msSaveBlob(blob, fileName);\r\n            return;\r\n        }\r\n\r\n        const url = window.URL.createObjectURL(blob);\r\n        const a = document.createElement(\"a\");\r\n        document.body.appendChild(a);\r\n        a.style.display = \"none\";\r\n        a.href = url;\r\n        a.download = fileName;\r\n        a.addEventListener(\"click\", () => {\r\n            if (a.parentElement) {\r\n                a.parentElement.removeChild(a);\r\n            }\r\n        });\r\n        a.click();\r\n        window.URL.revokeObjectURL(url);\r\n    }\r\n\r\n    /**\r\n     * Will return the right value of the noPreventDefault variable\r\n     * Needed to keep backwards compatibility to the old API.\r\n     *\r\n     * @param args arguments passed to the attachControl function\r\n     * @returns the correct value for noPreventDefault\r\n     */\r\n    public static BackCompatCameraNoPreventDefault(args: IArguments): boolean {\r\n        // is it used correctly?\r\n        if (typeof args[0] === \"boolean\") {\r\n            return args[0];\r\n        } else if (typeof args[1] === \"boolean\") {\r\n            return args[1];\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * Captures a screenshot of the current rendering\r\n     * @see https://doc.babylonjs.com/how_to/render_scene_on_a_png\r\n     * @param engine defines the rendering engine\r\n     * @param camera defines the source camera\r\n     * @param size This parameter can be set to a single number or to an object with the\r\n     * following (optional) properties: precision, width, height. If a single number is passed,\r\n     * it will be used for both width and height. If an object is passed, the screenshot size\r\n     * will be derived from the parameters. The precision property is a multiplier allowing\r\n     * rendering at a higher or lower resolution\r\n     * @param successCallback defines the callback receives a single parameter which contains the\r\n     * screenshot as a string of base64-encoded characters. This string can be assigned to the\r\n     * src parameter of an <img> to display it\r\n     * @param mimeType defines the MIME type of the screenshot image (default: image/png).\r\n     * Check your browser for supported MIME types\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    public static CreateScreenshot(engine: Engine, camera: Camera, size: IScreenshotSize | number, successCallback?: (data: string) => void, mimeType: string = \"image/png\"): void {\r\n        throw _WarnImport(\"ScreenshotTools\");\r\n    }\r\n\r\n    /**\r\n     * Captures a screenshot of the current rendering\r\n     * @see https://doc.babylonjs.com/how_to/render_scene_on_a_png\r\n     * @param engine defines the rendering engine\r\n     * @param camera defines the source camera\r\n     * @param size This parameter can be set to a single number or to an object with the\r\n     * following (optional) properties: precision, width, height. If a single number is passed,\r\n     * it will be used for both width and height. If an object is passed, the screenshot size\r\n     * will be derived from the parameters. The precision property is a multiplier allowing\r\n     * rendering at a higher or lower resolution\r\n     * @param mimeType defines the MIME type of the screenshot image (default: image/png).\r\n     * Check your browser for supported MIME types\r\n     * @returns screenshot as a string of base64-encoded characters. This string can be assigned\r\n     * to the src parameter of an <img> to display it\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    public static CreateScreenshotAsync(engine: Engine, camera: Camera, size: IScreenshotSize | number, mimeType: string = \"image/png\"): Promise<string> {\r\n        throw _WarnImport(\"ScreenshotTools\");\r\n    }\r\n\r\n    /**\r\n     * Generates an image screenshot from the specified camera.\r\n     * @see https://doc.babylonjs.com/how_to/render_scene_on_a_png\r\n     * @param engine The engine to use for rendering\r\n     * @param camera The camera to use for rendering\r\n     * @param size This parameter can be set to a single number or to an object with the\r\n     * following (optional) properties: precision, width, height. If a single number is passed,\r\n     * it will be used for both width and height. If an object is passed, the screenshot size\r\n     * will be derived from the parameters. The precision property is a multiplier allowing\r\n     * rendering at a higher or lower resolution\r\n     * @param successCallback The callback receives a single parameter which contains the\r\n     * screenshot as a string of base64-encoded characters. This string can be assigned to the\r\n     * src parameter of an <img> to display it\r\n     * @param mimeType The MIME type of the screenshot image (default: image/png).\r\n     * Check your browser for supported MIME types\r\n     * @param samples Texture samples (default: 1)\r\n     * @param antialiasing Whether antialiasing should be turned on or not (default: false)\r\n     * @param fileName A name for for the downloaded file.\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    public static CreateScreenshotUsingRenderTarget(\r\n        engine: Engine,\r\n        camera: Camera,\r\n        size: IScreenshotSize | number,\r\n        successCallback?: (data: string) => void,\r\n        mimeType: string = \"image/png\",\r\n        samples: number = 1,\r\n        antialiasing: boolean = false,\r\n        fileName?: string\r\n    ): void {\r\n        throw _WarnImport(\"ScreenshotTools\");\r\n    }\r\n\r\n    /**\r\n     * Generates an image screenshot from the specified camera.\r\n     * @see https://doc.babylonjs.com/how_to/render_scene_on_a_png\r\n     * @param engine The engine to use for rendering\r\n     * @param camera The camera to use for rendering\r\n     * @param size This parameter can be set to a single number or to an object with the\r\n     * following (optional) properties: precision, width, height. If a single number is passed,\r\n     * it will be used for both width and height. If an object is passed, the screenshot size\r\n     * will be derived from the parameters. The precision property is a multiplier allowing\r\n     * rendering at a higher or lower resolution\r\n     * @param mimeType The MIME type of the screenshot image (default: image/png).\r\n     * Check your browser for supported MIME types\r\n     * @param samples Texture samples (default: 1)\r\n     * @param antialiasing Whether antialiasing should be turned on or not (default: false)\r\n     * @param fileName A name for for the downloaded file.\r\n     * @returns screenshot as a string of base64-encoded characters. This string can be assigned\r\n     * to the src parameter of an <img> to display it\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    public static CreateScreenshotUsingRenderTargetAsync(\r\n        engine: Engine,\r\n        camera: Camera,\r\n        size: IScreenshotSize | number,\r\n        mimeType: string = \"image/png\",\r\n        samples: number = 1,\r\n        antialiasing: boolean = false,\r\n        fileName?: string\r\n    ): Promise<string> {\r\n        throw _WarnImport(\"ScreenshotTools\");\r\n    }\r\n\r\n    /**\r\n     * Implementation from http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/2117523#answer-2117523\r\n     * Be aware Math.random() could cause collisions, but:\r\n     * \"All but 6 of the 128 bits of the ID are randomly generated, which means that for any two ids, there's a 1 in 2^^122 (or 5.3x10^^36) chance they'll collide\"\r\n     * @returns a pseudo random id\r\n     */\r\n    public static RandomId(): string {\r\n        return RandomGUID();\r\n    }\r\n\r\n    /**\r\n     * Test if the given uri is a base64 string\r\n     * @deprecated Please use FileTools.IsBase64DataUrl instead.\r\n     * @param uri The uri to test\r\n     * @return True if the uri is a base64 string or false otherwise\r\n     */\r\n    public static IsBase64(uri: string): boolean {\r\n        return IsBase64DataUrl(uri);\r\n    }\r\n\r\n    /**\r\n     * Decode the given base64 uri.\r\n     * @deprecated Please use FileTools.DecodeBase64UrlToBinary instead.\r\n     * @param uri The uri to decode\r\n     * @return The decoded base64 data.\r\n     */\r\n    public static DecodeBase64(uri: string): ArrayBuffer {\r\n        return DecodeBase64UrlToBinary(uri);\r\n    }\r\n\r\n    public static GetAbsoluteUrl: (url: string) => string =\r\n        typeof document === \"object\"\r\n            ? (url) => {\r\n                  const a = document.createElement(\"a\");\r\n                  a.href = url;\r\n                  return a.href;\r\n              }\r\n            : typeof URL === \"function\" && typeof location === \"object\"\r\n            ? (url) => new URL(url, location.origin).href\r\n            : () => {\r\n                  throw new Error(\"Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.\");\r\n              };\r\n\r\n    // Logs\r\n    /**\r\n     * No log\r\n     */\r\n    public static readonly NoneLogLevel = Logger.NoneLogLevel;\r\n    /**\r\n     * Only message logs\r\n     */\r\n    public static readonly MessageLogLevel = Logger.MessageLogLevel;\r\n    /**\r\n     * Only warning logs\r\n     */\r\n    public static readonly WarningLogLevel = Logger.WarningLogLevel;\r\n    /**\r\n     * Only error logs\r\n     */\r\n    public static readonly ErrorLogLevel = Logger.ErrorLogLevel;\r\n    /**\r\n     * All logs\r\n     */\r\n    public static readonly AllLogLevel = Logger.AllLogLevel;\r\n\r\n    /**\r\n     * Gets a value indicating the number of loading errors\r\n     * @ignorenaming\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    public static get errorsCount(): number {\r\n        return Logger.errorsCount;\r\n    }\r\n\r\n    /**\r\n     * Callback called when a new log is added\r\n     */\r\n    public static OnNewCacheEntry: (entry: string) => void;\r\n\r\n    /**\r\n     * Log a message to the console\r\n     * @param message defines the message to log\r\n     */\r\n    public static Log(message: string): void {\r\n        Logger.Log(message);\r\n    }\r\n\r\n    /**\r\n     * Write a warning message to the console\r\n     * @param message defines the message to log\r\n     */\r\n    public static Warn(message: string): void {\r\n        Logger.Warn(message);\r\n    }\r\n\r\n    /**\r\n     * Write an error message to the console\r\n     * @param message defines the message to log\r\n     */\r\n    public static Error(message: string): void {\r\n        Logger.Error(message);\r\n    }\r\n\r\n    /**\r\n     * Gets current log cache (list of logs)\r\n     */\r\n    public static get LogCache(): string {\r\n        return Logger.LogCache;\r\n    }\r\n\r\n    /**\r\n     * Clears the log cache\r\n     */\r\n    public static ClearLogCache(): void {\r\n        Logger.ClearLogCache();\r\n    }\r\n\r\n    /**\r\n     * Sets the current log level (MessageLogLevel / WarningLogLevel / ErrorLogLevel)\r\n     */\r\n    public static set LogLevels(level: number) {\r\n        Logger.LogLevels = level;\r\n    }\r\n\r\n    /**\r\n     * Checks if the window object exists\r\n     * Back Compat only, please use IsWindowObjectExist instead.\r\n     */\r\n    public static IsWindowObjectExist = IsWindowObjectExist;\r\n\r\n    // Performances\r\n\r\n    /**\r\n     * No performance log\r\n     */\r\n    public static readonly PerformanceNoneLogLevel = 0;\r\n    /**\r\n     * Use user marks to log performance\r\n     */\r\n    public static readonly PerformanceUserMarkLogLevel = 1;\r\n    /**\r\n     * Log performance to the console\r\n     */\r\n    public static readonly PerformanceConsoleLogLevel = 2;\r\n\r\n    private static _Performance: Performance;\r\n\r\n    /**\r\n     * Sets the current performance log level\r\n     */\r\n    public static set PerformanceLogLevel(level: number) {\r\n        if ((level & Tools.PerformanceUserMarkLogLevel) === Tools.PerformanceUserMarkLogLevel) {\r\n            Tools.StartPerformanceCounter = Tools._StartUserMark;\r\n            Tools.EndPerformanceCounter = Tools._EndUserMark;\r\n            return;\r\n        }\r\n\r\n        if ((level & Tools.PerformanceConsoleLogLevel) === Tools.PerformanceConsoleLogLevel) {\r\n            Tools.StartPerformanceCounter = Tools._StartPerformanceConsole;\r\n            Tools.EndPerformanceCounter = Tools._EndPerformanceConsole;\r\n            return;\r\n        }\r\n\r\n        Tools.StartPerformanceCounter = Tools._StartPerformanceCounterDisabled;\r\n        Tools.EndPerformanceCounter = Tools._EndPerformanceCounterDisabled;\r\n    }\r\n\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    private static _StartPerformanceCounterDisabled(counterName: string, condition?: boolean): void {}\r\n\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    private static _EndPerformanceCounterDisabled(counterName: string, condition?: boolean): void {}\r\n\r\n    private static _StartUserMark(counterName: string, condition = true): void {\r\n        if (!Tools._Performance) {\r\n            if (!IsWindowObjectExist()) {\r\n                return;\r\n            }\r\n            Tools._Performance = window.performance;\r\n        }\r\n\r\n        if (!condition || !Tools._Performance.mark) {\r\n            return;\r\n        }\r\n        Tools._Performance.mark(counterName + \"-Begin\");\r\n    }\r\n\r\n    private static _EndUserMark(counterName: string, condition = true): void {\r\n        if (!condition || !Tools._Performance.mark) {\r\n            return;\r\n        }\r\n        Tools._Performance.mark(counterName + \"-End\");\r\n        Tools._Performance.measure(counterName, counterName + \"-Begin\", counterName + \"-End\");\r\n    }\r\n\r\n    private static _StartPerformanceConsole(counterName: string, condition = true): void {\r\n        if (!condition) {\r\n            return;\r\n        }\r\n\r\n        Tools._StartUserMark(counterName, condition);\r\n\r\n        if (console.time) {\r\n            console.time(counterName);\r\n        }\r\n    }\r\n\r\n    private static _EndPerformanceConsole(counterName: string, condition = true): void {\r\n        if (!condition) {\r\n            return;\r\n        }\r\n\r\n        Tools._EndUserMark(counterName, condition);\r\n\r\n        console.timeEnd(counterName);\r\n    }\r\n\r\n    /**\r\n     * Starts a performance counter\r\n     */\r\n    public static StartPerformanceCounter: (counterName: string, condition?: boolean) => void = Tools._StartPerformanceCounterDisabled;\r\n\r\n    /**\r\n     * Ends a specific performance counter\r\n     */\r\n    public static EndPerformanceCounter: (counterName: string, condition?: boolean) => void = Tools._EndPerformanceCounterDisabled;\r\n\r\n    /**\r\n     * Gets either window.performance.now() if supported or Date.now() else\r\n     */\r\n    public static get Now(): number {\r\n        return PrecisionDate.Now;\r\n    }\r\n\r\n    /**\r\n     * This method will return the name of the class used to create the instance of the given object.\r\n     * It will works only on Javascript basic data types (number, string, ...) and instance of class declared with the @className decorator.\r\n     * @param object the object to get the class name from\r\n     * @param isType defines if the object is actually a type\r\n     * @returns the name of the class, will be \"object\" for a custom data type not using the @className decorator\r\n     */\r\n    public static GetClassName(object: any, isType: boolean = false): string {\r\n        let name = null;\r\n\r\n        if (!isType && object.getClassName) {\r\n            name = object.getClassName();\r\n        } else {\r\n            if (object instanceof Object) {\r\n                const classObj = isType ? object : Object.getPrototypeOf(object);\r\n                name = classObj.constructor[\"__bjsclassName__\"];\r\n            }\r\n            if (!name) {\r\n                name = typeof object;\r\n            }\r\n        }\r\n        return name;\r\n    }\r\n\r\n    /**\r\n     * Gets the first element of an array satisfying a given predicate\r\n     * @param array defines the array to browse\r\n     * @param predicate defines the predicate to use\r\n     * @returns null if not found or the element\r\n     */\r\n    public static First<T>(array: Array<T>, predicate: (item: T) => boolean): Nullable<T> {\r\n        for (const el of array) {\r\n            if (predicate(el)) {\r\n                return el;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * This method will return the name of the full name of the class, including its owning module (if any).\r\n     * It will works only on Javascript basic data types (number, string, ...) and instance of class declared with the @className decorator or implementing a method getClassName():string (in which case the module won't be specified).\r\n     * @param object the object to get the class name from\r\n     * @param isType defines if the object is actually a type\r\n     * @return a string that can have two forms: \"moduleName.className\" if module was specified when the class' Name was registered or \"className\" if there was not module specified.\r\n     * @ignorenaming\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    public static getFullClassName(object: any, isType: boolean = false): Nullable<string> {\r\n        let className = null;\r\n        let moduleName = null;\r\n\r\n        if (!isType && object.getClassName) {\r\n            className = object.getClassName();\r\n        } else {\r\n            if (object instanceof Object) {\r\n                const classObj = isType ? object : Object.getPrototypeOf(object);\r\n                className = classObj.constructor[\"__bjsclassName__\"];\r\n                moduleName = classObj.constructor[\"__bjsmoduleName__\"];\r\n            }\r\n            if (!className) {\r\n                className = typeof object;\r\n            }\r\n        }\r\n\r\n        if (!className) {\r\n            return null;\r\n        }\r\n\r\n        return (moduleName != null ? moduleName + \".\" : \"\") + className;\r\n    }\r\n\r\n    /**\r\n     * Returns a promise that resolves after the given amount of time.\r\n     * @param delay Number of milliseconds to delay\r\n     * @returns Promise that resolves after the given amount of time\r\n     */\r\n    public static DelayAsync(delay: number): Promise<void> {\r\n        return new Promise((resolve) => {\r\n            setTimeout(() => {\r\n                resolve();\r\n            }, delay);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Utility function to detect if the current user agent is Safari\r\n     * @returns whether or not the current user agent is safari\r\n     */\r\n    public static IsSafari(): boolean {\r\n        if (!IsNavigatorAvailable()) {\r\n            return false;\r\n        }\r\n\r\n        return /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\r\n    }\r\n}\r\n\r\n/**\r\n * Use this className as a decorator on a given class definition to add it a name and optionally its module.\r\n * You can then use the Tools.getClassName(obj) on an instance to retrieve its class name.\r\n * This method is the only way to get it done in all cases, even if the .js file declaring the class is minified\r\n * @param name The name of the class, case should be preserved\r\n * @param module The name of the Module hosting the class, optional, but strongly recommended to specify if possible. Case should be preserved.\r\n */\r\nexport function className(name: string, module?: string): (target: Object) => void {\r\n    return (target: Object) => {\r\n        (<any>target)[\"__bjsclassName__\"] = name;\r\n        (<any>target)[\"__bjsmoduleName__\"] = module != null ? module : null;\r\n    };\r\n}\r\n\r\n/**\r\n * An implementation of a loop for asynchronous functions.\r\n */\r\nexport class AsyncLoop {\r\n    /**\r\n     * Defines the current index of the loop.\r\n     */\r\n    public index: number;\r\n    private _done: boolean;\r\n    private _fn: (asyncLoop: AsyncLoop) => void;\r\n    private _successCallback: () => void;\r\n\r\n    /**\r\n     * Constructor.\r\n     * @param iterations the number of iterations.\r\n     * @param func the function to run each iteration\r\n     * @param successCallback the callback that will be called upon successful execution\r\n     * @param offset starting offset.\r\n     */\r\n    constructor(\r\n        /**\r\n         * Defines the number of iterations for the loop\r\n         */\r\n        public iterations: number,\r\n        func: (asyncLoop: AsyncLoop) => void,\r\n        successCallback: () => void,\r\n        offset: number = 0\r\n    ) {\r\n        this.index = offset - 1;\r\n        this._done = false;\r\n        this._fn = func;\r\n        this._successCallback = successCallback;\r\n    }\r\n\r\n    /**\r\n     * Execute the next iteration. Must be called after the last iteration was finished.\r\n     */\r\n    public executeNext(): void {\r\n        if (!this._done) {\r\n            if (this.index + 1 < this.iterations) {\r\n                ++this.index;\r\n                this._fn(this);\r\n            } else {\r\n                this.breakLoop();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Break the loop and run the success callback.\r\n     */\r\n    public breakLoop(): void {\r\n        this._done = true;\r\n        this._successCallback();\r\n    }\r\n\r\n    /**\r\n     * Create and run an async loop.\r\n     * @param iterations the number of iterations.\r\n     * @param fn the function to run each iteration\r\n     * @param successCallback the callback that will be called upon successful execution\r\n     * @param offset starting offset.\r\n     * @returns the created async loop object\r\n     */\r\n    public static Run(iterations: number, fn: (asyncLoop: AsyncLoop) => void, successCallback: () => void, offset: number = 0): AsyncLoop {\r\n        const loop = new AsyncLoop(iterations, fn, successCallback, offset);\r\n\r\n        loop.executeNext();\r\n\r\n        return loop;\r\n    }\r\n\r\n    /**\r\n     * A for-loop that will run a given number of iterations synchronous and the rest async.\r\n     * @param iterations total number of iterations\r\n     * @param syncedIterations number of synchronous iterations in each async iteration.\r\n     * @param fn the function to call each iteration.\r\n     * @param callback a success call back that will be called when iterating stops.\r\n     * @param breakFunction a break condition (optional)\r\n     * @param timeout timeout settings for the setTimeout function. default - 0.\r\n     * @returns the created async loop object\r\n     */\r\n    public static SyncAsyncForLoop(\r\n        iterations: number,\r\n        syncedIterations: number,\r\n        fn: (iteration: number) => void,\r\n        callback: () => void,\r\n        breakFunction?: () => boolean,\r\n        timeout: number = 0\r\n    ): AsyncLoop {\r\n        return AsyncLoop.Run(\r\n            Math.ceil(iterations / syncedIterations),\r\n            (loop: AsyncLoop) => {\r\n                if (breakFunction && breakFunction()) {\r\n                    loop.breakLoop();\r\n                } else {\r\n                    setTimeout(() => {\r\n                        for (let i = 0; i < syncedIterations; ++i) {\r\n                            const iteration = loop.index * syncedIterations + i;\r\n                            if (iteration >= iterations) {\r\n                                break;\r\n                            }\r\n                            fn(iteration);\r\n                            if (breakFunction && breakFunction()) {\r\n                                loop.breakLoop();\r\n                                break;\r\n                            }\r\n                        }\r\n                        loop.executeNext();\r\n                    }, timeout);\r\n                }\r\n            },\r\n            callback\r\n        );\r\n    }\r\n}\r\n\r\n// Will only be define if Tools is imported freeing up some space when only engine is required\r\nEngineStore.FallbackTexture =\r\n    \"data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z\";\r\n\r\n// Register promise fallback for IE\r\nPromisePolyfill.Apply();\r\n"]},"metadata":{},"sourceType":"module"}